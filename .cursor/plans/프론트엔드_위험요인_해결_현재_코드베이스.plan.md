# í”„ë¡ íŠ¸ì—”ë“œ ìœ„í—˜ìš”ì¸ í•´ê²° í”Œëœ (í˜„ì¬ ì½”ë“œë² ì´ìŠ¤ìš©)

**ê¸°ì¤€ ì½”ë“œë² ì´ìŠ¤**: C:\INEESm

**ê²€ì¦ ì™„ë£Œ**: 2026-01-17 (ìµœì¢… ì—…ë°ì´íŠ¸)

**ìœ„í—˜ìš”ì¸**: 39ê°œ (Critical 5, High 13, Medium 16, Low 6)

**í•´ê²° ì™„ë£Œ**: FE-C6 (useRealtime cleanup)

**ì‹ ê·œ ë°œê²¬**: FE-H13 (CoachPersona íƒ€ì… ë¶ˆì¼ì¹˜)

**ì¦‰ì‹œ ì¡°ì¹˜**: P0 5ê°œ + P1 1ê°œ (FE-H13)

**ì´ ê¸°ê°„**: 2.5ì¼ (P0 2ì¼ + P1 0.5ì¼)

---

## ì „ì œ ì¡°ê±´

âœ… **ê²€ì¦ ì™„ë£Œ í•­ëª©**:

- useRealtime cleanup ì¡´ì¬ í™•ì¸ (ëª¨ë“  4ê°œ useEffect)
- OnboardingGuard localStorageë§Œ ì‚¬ìš© (í´ë°± ì—†ìŒ)
- window.onerror í•¸ë“¤ëŸ¬ ì—†ìŒ
- ìœ„ê¸° ê°ì§€ í‚¤ì›Œë“œ ê¸°ë°˜ë§Œ (Gemini ì—†ìŒ)
- DayMode ë©”ì‹œì§€ ë°°ì—´ ì œí•œ ì—†ìŒ
- ì…ë ¥ ê¸¸ì´ ê²€ì¦ ì—†ìŒ
- **CoachPersona íƒ€ì… ë¶ˆì¼ì¹˜** (PRD ëª…ì„¸ì™€ ë‹¤ë¦„, humor/expertise ì—†ìŒ)

---

## Day 0: ì‚¬ì „ ì¤€ë¹„ (1ì‹œê°„)

### Task 0.1: Git ë°±ì—…

```bash
cd C:\INEESm

# ì˜ì¡´ì„± í™•ì¸
npm audit
npm outdated

# í˜„ì¬ ìƒíƒœ ë°±ì—…
git add .
git status
git commit -m "chore: backup before P0 critical fixes"
git tag v5.0-p0-fixes-start
git push origin v5.0-p0-fixes-start
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:

- [ ] Git ì»¤ë°‹ ì™„ë£Œ
- [ ] tag ìƒì„± ì™„ë£Œ
- [ ] ë¹Œë“œ ì„±ê³µ: `npm run build`
- [ ] ë³´ì•ˆ ì·¨ì•½ì  0ê°œ

---

### Task 0.2: ê²€ì¦ ë„êµ¬ ì‹¤í–‰

```bash
# ë¬¸ì œ ìœ„ì¹˜ í™•ì¸
rg "window.onerror" index.tsx          # ì—†ì–´ì•¼ í•¨
rg "maxLength" src/components/chat/    # ì—†ì–´ì•¼ í•¨
rg "slice\(-100\)" src/features/       # ì—†ì–´ì•¼ í•¨
rg "sessionStorage" src/router/guards.tsx  # ì—†ì–´ì•¼ í•¨
```

---

## Day 1: Critical 5ê°œ (6ì‹œê°„)

### Task 1.1: window.onerror í•¸ë“¤ëŸ¬ (1ì‹œê°„)

**íŒŒì¼**: [`index.tsx`](index.tsx)

**ìˆ˜ì • ì „** (í˜„ì¬ 16ì¤„):

```typescript
import React from 'react';
import ReactDOM from 'react-dom/client';
import { AppRouter } from './src/router/Router';
import './src/index.css';

const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <AppRouter />
  </React.StrictMode>
);
```

**ìˆ˜ì • í›„**:

```typescript
import React from 'react';
import ReactDOM from 'react-dom/client';
import { AppRouter } from './src/router/Router';
import './src/index.css';

/**
 * ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬ (FE-C3 í•´ê²°)
 * ErrorBoundary ë°–ì˜ ì—ëŸ¬ë„ ìºì¹˜
 */
window.onerror = (message, source, lineno, colno, error) => {
  const errorLog = {
    timestamp: new Date().toISOString(),
    message: String(message),
    source: source || 'unknown',
    line: lineno || 0,
    column: colno || 0,
    stack: error?.stack || 'No stack trace',
    url: window.location.href,
    userAgent: navigator.userAgent,
  };
  
  // localStorageì— ë¡œê¹… (ìµœê·¼ 50ê°œë§Œ ìœ ì§€)
  try {
    const logs = JSON.parse(localStorage.getItem('error_logs') || '[]');
    logs.push(errorLog);
    localStorage.setItem('error_logs', JSON.stringify(logs.slice(-50)));
  } catch (storageError) {
    console.error('Failed to save error log to localStorage:', storageError);
  }
  
  console.error('Global error caught:', errorLog);
  return false; // ê¸°ë³¸ ì—ëŸ¬ ì²˜ë¦¬ ê³„ì† ì§„í–‰
};

/**
 * ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise rejection í•¸ë“¤ëŸ¬
 */
window.onunhandledrejection = (event) => {
  const errorLog = {
    timestamp: new Date().toISOString(),
    message: event.reason ? String(event.reason) : 'Unknown rejection',
    type: 'unhandledrejection',
    url: window.location.href,
  };
  
  try {
    const logs = JSON.parse(localStorage.getItem('error_logs') || '[]');
    logs.push(errorLog);
    localStorage.setItem('error_logs', JSON.stringify(logs.slice(-50)));
  } catch (storageError) {
    console.error('Failed to save rejection log:', storageError);
  }
  
  console.error('Unhandled promise rejection:', errorLog);
};

const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <AppRouter />
  </React.StrictMode>
);
```

**í…ŒìŠ¤íŠ¸**:

```javascript
// ê°œë°œì ë„êµ¬ ì½˜ì†”ì—ì„œ ì‹¤í–‰
throw new Error('Test error'); // window.onerror íŠ¸ë¦¬ê±°
Promise.reject('Test rejection'); // onunhandledrejection íŠ¸ë¦¬ê±°

// localStorage í™•ì¸
JSON.parse(localStorage.getItem('error_logs'));
```

**ì»¤ë°‹**:

```bash
git add index.tsx
git commit -m "fix(frontend): add window.onerror handler (FE-C3)"
```

---

### Task 1.2: OnboardingGuard sessionStorage í´ë°± (1.5ì‹œê°„)

**íŒŒì¼**: [`src/router/guards.tsx`](src/router/guards.tsx)

**ìˆ˜ì • ì „** (14-19ë¼ì¸):

```typescript
export const useOnboardingStatus = (): boolean => {
  try {
    return localStorage.getItem('onboarding_completed') === 'true';
  } catch {
    // localStorage ì ‘ê·¼ ì‹¤íŒ¨ ì‹œ (ì˜ˆ: ì‚¬ìƒí™œ ë³´í˜¸ ëª¨ë“œ) ê¸°ë³¸ê°’ ë°˜í™˜
    return false;
  }
};
```

**ìˆ˜ì • í›„**:

```typescript
/**
 * ì˜¨ë³´ë”© ì™„ë£Œ ì—¬ë¶€ í™•ì¸ (FE-C1 í•´ê²°)
 * 
 * 3ë‹¨ê³„ í´ë°±:
 * 1. localStorage (ìš°ì„ )
 * 2. sessionStorage (í´ë°±)
 * 3. ë¦¬ë‹¤ì´ë ‰íŠ¸ ì¹´ìš´í„° (ë¬´í•œ ë£¨í”„ ë°©ì§€)
 */
export const useOnboardingStatus = (): boolean => {
  // 1ë‹¨ê³„: localStorage ì‹œë„
  try {
    const completed = localStorage.getItem('onboarding_completed');
    if (completed === 'true') return true;
  } catch (error) {
    console.warn('localStorage ì ‘ê·¼ ì‹¤íŒ¨, sessionStorageë¡œ í´ë°±:', error);
  }
  
  // 2ë‹¨ê³„: sessionStorage í´ë°±
  try {
    const completed = sessionStorage.getItem('onboarding_completed');
    if (completed === 'true') return true;
  } catch (error) {
    console.warn('sessionStorage ì ‘ê·¼ ì‹¤íŒ¨, ë¦¬ë‹¤ì´ë ‰íŠ¸ ì¹´ìš´í„° í™•ì¸:', error);
  }
  
  // 3ë‹¨ê³„: ë¬´í•œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë°©ì§€ (3íšŒ ì œí•œ)
  try {
    const redirectCount = parseInt(sessionStorage.getItem('onboarding_redirect_count') || '0');
    if (redirectCount >= 3) {
      console.warn('ì˜¨ë³´ë”© ë¦¬ë‹¤ì´ë ‰íŠ¸ 3íšŒ ì´ˆê³¼, ê°•ì œ í†µê³¼');
      // ê°•ì œ í†µê³¼ (ë” ì´ìƒ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ì§€ ì•ŠìŒ)
      return true;
    }
    // ì¹´ìš´í„° ì¦ê°€
    sessionStorage.setItem('onboarding_redirect_count', String(redirectCount + 1));
  } catch (error) {
    // sessionStorageë„ ì‹¤íŒ¨í•˜ë©´ ì–´ì©” ìˆ˜ ì—†ì´ false
    console.error('ë¦¬ë‹¤ì´ë ‰íŠ¸ ì¹´ìš´í„° ì ‘ê·¼ ì‹¤íŒ¨:', error);
  }
  
  return false;
};
```

**OnboardingLayout ìˆ˜ì •**: [`src/components/layout/OnboardingLayout.tsx`](src/components/layout/OnboardingLayout.tsx)

```typescript
// handleOnboardingComplete í•¨ìˆ˜ ì°¾ì•„ì„œ ìˆ˜ì •
const handleOnboardingComplete = (data: OnboardingData) => {
  console.log('ì˜¨ë³´ë”© ì™„ë£Œ:', data);
  
  // localStorage ìš°ì„  ì €ì¥
  try {
    localStorage.setItem('onboarding_completed', 'true');
  } catch (error) {
    console.warn('localStorage ì €ì¥ ì‹¤íŒ¨, sessionStorage ì‚¬ìš©:', error);
    try {
      sessionStorage.setItem('onboarding_completed', 'true');
    } catch (sessionError) {
      console.error('sessionStorage ì €ì¥ë„ ì‹¤íŒ¨:', sessionError);
    }
  }
  
  // ë¦¬ë‹¤ì´ë ‰íŠ¸ ì¹´ìš´í„° ì´ˆê¸°í™”
  try {
    sessionStorage.removeItem('onboarding_redirect_count');
  } catch (error) {
    console.warn('ë¦¬ë‹¤ì´ë ‰íŠ¸ ì¹´ìš´í„° ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
  }
  
  // ê¸°ì¡´ ë¡œì§ ê³„ì† (Firestore ì €ì¥ ë“±)
  setIsOnboardingCompleted(true);
};
```

**í…ŒìŠ¤íŠ¸**: ì‚¬ìƒí™œ ë³´í˜¸ ëª¨ë“œ

```bash
# Chrome: Ctrl+Shift+N (ì‹œí¬ë¦¿ ëª¨ë“œ)
# Firefox: Ctrl+Shift+P (ì‚¬ìƒí™œ ë³´í˜¸ ëª¨ë“œ)
# 1. ì˜¨ë³´ë”© ì§„í–‰
# 2. localStorage ì €ì¥ ì‹¤íŒ¨ â†’ sessionStorage ì €ì¥ í™•ì¸
# 3. ë¦¬ë‹¤ì´ë ‰íŠ¸ 3íšŒ í›„ ê°•ì œ í†µê³¼ í™•ì¸
```

**ì»¤ë°‹**:

```bash
git add src/router/guards.tsx src/components/layout/OnboardingLayout.tsx
git commit -m "fix(frontend): add sessionStorage fallback for OnboardingGuard (FE-C1)"
```

---

### Task 1.3: ì…ë ¥ ê¸¸ì´ ê²€ì¦ 10000ì (30ë¶„)

**íŒŒì¼**:

- [`src/components/chat/DayMode.tsx`](src/components/chat/DayMode.tsx)
- [`src/components/chat/NightMode.tsx`](src/components/chat/NightMode.tsx)

**DayMode.tsx ìˆ˜ì •**:

```typescript
// íŒŒì¼ ìƒë‹¨ì— ìƒìˆ˜ ì¶”ê°€
const MAX_INPUT_LENGTH = 10000;

// input íƒœê·¸ ì°¾ì•„ì„œ maxLength ì¶”ê°€
<input
  type="text"
  maxLength={MAX_INPUT_LENGTH}  // ì¶”ê°€
  value={input}
  onChange={(e) => machine.updateInput(e.target.value)}
  placeholder="ì§€ê¸ˆ ì–´ë–¤ ê¸°ë¶„ì´ì„¸ìš”?"
  className="..."
/>

// (ì„ íƒì‚¬í•­) ê¸¸ì´ ê²½ê³  í‘œì‹œ
{input.length > 9000 && (
  <p className="text-xs text-orange-500 mt-1">
    âš ï¸ {MAX_INPUT_LENGTH - input.length}ì ë‚¨ìŒ
  </p>
)}
```

**NightMode.tsx ìˆ˜ì •**:

```typescript
// íŒŒì¼ ìƒë‹¨ì— ìƒìˆ˜ ì¶”ê°€
const MAX_INPUT_LENGTH = 10000;

// textarea íƒœê·¸ ì°¾ì•„ì„œ maxLength ì¶”ê°€
<textarea
  maxLength={MAX_INPUT_LENGTH}  // ì¶”ê°€
  value={machine.diary}
  onChange={(e) => machine.updateDiary(e.target.value)}
  placeholder="ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ëŒì•„ë³´ë©°..."
  className="..."
/>

// (ì„ íƒì‚¬í•­) ê¸¸ì´ í‘œì‹œ
<div className="text-xs text-gray-500 text-right mt-1">
  {machine.diary.length} / {MAX_INPUT_LENGTH}
</div>
```

**í…ŒìŠ¤íŠ¸**:

```bash
# 10000ì ì´ìƒ ì…ë ¥ ì‹œë„ â†’ ë§‰í˜ í™•ì¸
# 9000ì ì´ìƒ ì…ë ¥ ì‹œ ê²½ê³  í‘œì‹œ í™•ì¸
```

**ì»¤ë°‹**:

```bash
git add src/components/chat/DayMode.tsx src/components/chat/NightMode.tsx
git commit -m "fix(frontend): add maxLength 10000 for user input (BE-H2)"
```

---

### Task 1.4: DayMode ë©”ì‹œì§€ ë°°ì—´ ì œí•œ (30ë¶„)

**íŒŒì¼**: [`src/features/checkin/useDayCheckinMachine.ts`](src/features/checkin/useDayCheckinMachine.ts)

**ê²€ìƒ‰**:

```bash
rg "setMessages|messages.push" src/features/checkin/useDayCheckinMachine.ts
```

**ìˆ˜ì •**:

```typescript
// addMessage í•¨ìˆ˜ ì°¾ê¸° (ì •í™•í•œ ìœ„ì¹˜ëŠ” íŒŒì¼ ë‚´ìš©ì— ë”°ë¼ ë‹¤ë¦„)
// ê¸°ì¡´
const addMessage = (message: Message) => {
  setMessages(prev => [...prev, message]);
};

// ìˆ˜ì •
const addMessage = (message: Message) => {
  setMessages(prev => [...prev, message].slice(-100)); // ìµœê·¼ 100ê°œë§Œ ìœ ì§€
};

// ë˜ëŠ” setMessages ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ê³³ ëª¨ë‘ ìˆ˜ì •
setMessages(prev => [...prev, newMessage].slice(-100));
```

**í…ŒìŠ¤íŠ¸**:

```bash
# Chrome DevTools â†’ Memory â†’ Heap Snapshot
# 1. ëŒ€í™” 100ê°œ ì…ë ¥
# 2. Heap Snapshot ì°ê¸°
# 3. messages ë°°ì—´ í¬ê¸° í™•ì¸ (100ê°œ ì´í•˜ì—¬ì•¼ í•¨)
```

**ì»¤ë°‹**:

```bash
git add src/features/checkin/useDayCheckinMachine.ts
git commit -m "fix(frontend): limit DayMode messages array to 100 (FE-H2)"
```

---

### Task 1.5: Firebase Auth ì¬ì‹œë„ ì‹¤íŒ¨ UI (1.5ì‹œê°„)

**íŒŒì¼ 1**: [`src/contexts/UIContext.tsx`](src/contexts/UIContext.tsx)

**ìˆ˜ì •**:

```typescript
import React, { createContext, useContext, useState, useEffect } from 'react';

interface UIContextType {
  isOnline: boolean;
  // ... ê¸°ì¡´ í•„ë“œë“¤
}

const UIContext = createContext<UIContextType | undefined>(undefined);

export const UIProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  
  useEffect(() => {
    const handleOnline = () => {
      console.log('âœ… ë„¤íŠ¸ì›Œí¬ ì—°ê²°ë¨');
      setIsOnline(true);
    };
    
    const handleOffline = () => {
      console.warn('âš ï¸ ë„¤íŠ¸ì›Œí¬ ëŠê¹€');
      setIsOnline(false);
    };
    
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);
  
  return (
    <UIContext.Provider value={{ isOnline, /* ... */ }}>
      {children}
    </UIContext.Provider>
  );
};

export const useUIContext = () => {
  const context = useContext(UIContext);
  if (!context) {
    throw new Error('useUIContext must be used within UIProvider');
  }
  return context;
};
```

**íŒŒì¼ 2**: [`src/components/layout/MainLayout.tsx`](src/components/layout/MainLayout.tsx)

**ìˆ˜ì •**:

```typescript
import { useUIContext } from '../../contexts/UIContext';

export const MainLayout: React.FC = () => {
  const { isOnline } = useUIContext();
  
  return (
    <div className="relative w-full h-[100dvh]">
      {/* ì˜¤í”„ë¼ì¸ ë°°ë„ˆ (FE-C2 í•´ê²°) */}
      {!isOnline && (
        <div className="fixed top-0 left-0 right-0 z-[9999] bg-yellow-500 text-white text-center py-2 px-4 text-sm font-medium shadow-lg">
          âš ï¸ ì˜¤í”„ë¼ì¸ ëª¨ë“œ - ì¼ë¶€ ê¸°ëŠ¥ì´ ì œí•œë©ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
        </div>
      )}
      
      {/* ê¸°ì¡´ ë ˆì´ì•„ì›ƒ */}
      {children}
    </div>
  );
};
```

**í…ŒìŠ¤íŠ¸**:

```bash
# Chrome DevTools â†’ Network â†’ Offline ì²´í¬
# ì˜¤í”„ë¼ì¸ ë°°ë„ˆ í‘œì‹œ í™•ì¸
# Onlineìœ¼ë¡œ ë³€ê²½ â†’ ë°°ë„ˆ ì‚¬ë¼ì§ í™•ì¸
```

**ì»¤ë°‹**:

```bash
git add src/contexts/UIContext.tsx src/components/layout/MainLayout.tsx
git commit -m "fix(frontend): add offline mode banner (FE-C2)"
```

---

## Day 2: ìœ„ê¸° ê°ì§€ Gemini í†µí•© + DebugPanel (4ì‹œê°„)

### Task 2.1: ìœ„ê¸° ê°ì§€ Gemini API í†µí•© (3ì‹œê°„)

**íŒŒì¼**: [`src/services/crisisDetection.ts`](src/services/crisisDetection.ts)

**ì¶”ê°€ í•¨ìˆ˜**:

````typescript
import { generateChatbotResponse } from './functions';

/**
 * Gemini APIë¥¼ ì‚¬ìš©í•œ ì •ë°€ ìœ„ê¸° ê°ì§€ (FE-C4 í•´ê²°)
 * í‚¤ì›Œë“œ ê°ì§€ ì´í›„ 2ì°¨ ê²€ì¦ìš©
 */
async function detectCrisisWithGemini(message: string): Promise<{
  isCrisis: boolean;
  severity: 'none' | 'low' | 'medium' | 'high' | 'critical';
  reason?: string;
}> {
  try {
    const prompt = `ë‹¤ìŒ ë©”ì‹œì§€ê°€ ìí•´/ìì‚´ ìœ„í—˜ì„ ë‚˜íƒ€ë‚´ëŠ”ì§€ ë¶„ì„í•´ì£¼ì„¸ìš”.

ë©”ì‹œì§€: "${message}"

ì‘ë‹µ í˜•ì‹ (JSONë§Œ ë°˜í™˜):
{
  "isCrisis": true ë˜ëŠ” false,
  "severity": "none" | "low" | "medium" | "high" | "critical",
  "reason": "íŒë‹¨ ì´ìœ  í•œ ì¤„"
}

ê¸°ì¤€:
- none: ìœ„ê¸° ì‹ í˜¸ ì—†ìŒ
- low: ë§‰ì—°í•œ ë¶ˆì•ˆ, í”¼ë¡œ, ì¼ë°˜ì ì¸ ë¶€ì • ê°ì •
- medium: êµ¬ì²´ì  ë¶€ì • ê°ì •, "í¬ë§ ì—†ìŒ" í‘œí˜„
- high: ìí•´/ìì‚´ ê°„ì ‘ ì•”ì‹œ ("ë” ì´ìƒ ì‚´ ì˜ë¯¸ê°€ ì—†ì–´" ë“±)
- critical: ìí•´/ìì‚´ ì§ì ‘ì  ì˜ë„ ë˜ëŠ” êµ¬ì²´ì  ê³„íš

JSONë§Œ ë°˜í™˜í•˜ì„¸ìš”:`;

    const response = await generateChatbotResponse({
      userMessage: prompt,
      history: [],
      persona: {
        name: 'ë¶„ì„ê¸°',
        role: 'coach',
        mbti: 'INFJ',
        traits: { warmth: 50, directness: 50 }
      }
    });
    
    // JSON ì¶”ì¶œ (```json ... ``` ì œê±°)
    const jsonMatch = response.match(/\{[\s\S]*\}/);
    if (!jsonMatch) {
      throw new Error('JSON ì‘ë‹µ í˜•ì‹ ì•„ë‹˜');
    }
    
    const result = JSON.parse(jsonMatch[0]);
    return result;
  } catch (error) {
    console.error('Gemini ìœ„ê¸° ê°ì§€ ì‹¤íŒ¨:', error);
    // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì•ˆì „í•˜ê²Œ false ë°˜í™˜ (í‚¤ì›Œë“œ ê¸°ë°˜ìœ¼ë¡œ í´ë°±)
    return { isCrisis: false, severity: 'none' };
  }
}

/**
 * í†µí•© ìœ„ê¸° ê°ì§€ (í‚¤ì›Œë“œ + Gemini 2ë‹¨ê³„)
 */
export async function detectCrisis(
  message: string,
  intensity: number
): Promise<{
  level: 'none' | 'low' | 'medium' | 'high';
  shouldIntervene: boolean;
  reason: string;
}> {
  // 1ë‹¨ê³„: í‚¤ì›Œë“œ ê¸°ë°˜ ë¹ ë¥¸ ê°ì§€
  const keywordResult = detectCrisisKeywords(message);
  
  // í‚¤ì›Œë“œ ê°ì§€ ì‹œ Geminië¡œ 2ì°¨ ê²€ì¦
  if (keywordResult.level !== 'none') {
    console.log('ìœ„ê¸° í‚¤ì›Œë“œ ê°ì§€, Geminië¡œ 2ì°¨ ê²€ì¦ ì‹œì‘...');
    const geminiResult = await detectCrisisWithGemini(message);
    
    // Geminiê°€ critical ë˜ëŠ” high â†’ ì¦‰ì‹œ ê°œì…
    if (geminiResult.severity === 'critical' || geminiResult.severity === 'high') {
      return {
        level: 'high',
        shouldIntervene: true,
        reason: geminiResult.reason || 'ì‹¬ê°í•œ ìœ„ê¸° ì‹ í˜¸ ê°ì§€ (Gemini ë¶„ì„)'
      };
    }
    
    // Geminiê°€ medium + ê°ì • ê°•ë„ë„ ë†’ìŒ â†’ ê°œì…
    if (geminiResult.severity === 'medium' && intensity >= 8) {
      return {
        level: 'medium',
        shouldIntervene: true,
        reason: geminiResult.reason || 'ìœ„ê¸° ì‹ í˜¸ + ë†’ì€ ê°ì • ê°•ë„'
      };
    }
    
    // í‚¤ì›Œë“œ ì˜¤íƒì§€ (Geminiê°€ none ë˜ëŠ” low)
    if (geminiResult.severity === 'none' || geminiResult.severity === 'low') {
      console.log('í‚¤ì›Œë“œ ì˜¤íƒì§€ (Gemini ë¶„ì„: ìœ„ê¸° ì•„ë‹˜)');
      return {
        level: 'low',
        shouldIntervene: false,
        reason: 'ìœ„ê¸° ì‹ í˜¸ ë¯¸í™•ì¸ (Gemini ê²€ì¦)'
      };
    }
  }
  
  // í‚¤ì›Œë“œ ë¯¸ê°ì§€ + ê°ì • ê°•ë„ ë§¤ìš° ë†’ìŒ â†’ Geminië¡œ ê²€ì¦
  if (intensity >= 9) {
    console.log('ê°•ë„ 9+ ê°ì§€, Geminië¡œ ê°„ì ‘ ìœ„ê¸° ì‹ í˜¸ í™•ì¸...');
    const geminiResult = await detectCrisisWithGemini(message);
    
    if (geminiResult.severity === 'critical' || geminiResult.severity === 'high') {
      return {
        level: 'high',
        shouldIntervene: true,
        reason: geminiResult.reason || 'ê°„ì ‘ì  ìœ„ê¸° ì‹ í˜¸ ê°ì§€ (Gemini ë¶„ì„)'
      };
    }
  }
  
  // ê¸°ì¡´ í‚¤ì›Œë“œ ê¸°ë°˜ ê²°ê³¼ ë°˜í™˜
  return keywordResult;
}
````

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**:

```typescript
// í…ŒìŠ¤íŠ¸ 1: ì§ì ‘ í‘œí˜„
await detectCrisis('ì£½ê³  ì‹¶ì–´ìš”', 9);
// ì˜ˆìƒ: level='high', shouldIntervene=true

// í…ŒìŠ¤íŠ¸ 2: ê°„ì ‘ í‘œí˜„
await detectCrisis('ë” ì´ìƒ ì‚´ ì˜ë¯¸ê°€ ì—†ì–´', 8);
// ì˜ˆìƒ: level='high', shouldIntervene=true (Geminiê°€ ê°ì§€)

// í…ŒìŠ¤íŠ¸ 3: ì˜¤íƒì§€
await detectCrisis('ì£½ì„ ë§Œí¼ í”¼ê³¤í•´', 5);
// ì˜ˆìƒ: level='low', shouldIntervene=false (Geminiê°€ ì˜¤íƒ í•„í„°ë§)

// í…ŒìŠ¤íŠ¸ 4: ì¼ë°˜
await detectCrisis('ì˜¤ëŠ˜ ë‚ ì”¨ ì¢‹ì•„ìš”', 7);
// ì˜ˆìƒ: level='none', shouldIntervene=false
```

**ì»¤ë°‹**:

```bash
git add src/services/crisisDetection.ts
git commit -m "feat(frontend): integrate Gemini API for crisis detection (FE-C4)"
```

---

### Task 2.2: DebugPanel í˜ì´ì§€ ìƒì„± (1ì‹œê°„)

**ì‹ ê·œ íŒŒì¼**: [`src/pages/profile/DebugPanel.tsx`](src/pages/profile/DebugPanel.tsx)

```typescript
import React, { useState, useEffect } from 'react';
import { GlassCard, Button } from '../../components/ui';

interface ErrorLog {
  timestamp: string;
  message: string;
  source?: string;
  line?: number;
  column?: number;
  stack?: string;
  url?: string;
  type?: string;
}

export const DebugPanel: React.FC = () => {
  const [logs, setLogs] = useState<ErrorLog[]>([]);
  
  useEffect(() => {
    loadLogs();
  }, []);
  
  const loadLogs = () => {
    try {
      const storedLogs = JSON.parse(localStorage.getItem('error_logs') || '[]');
      setLogs(storedLogs.reverse()); // ìµœì‹ ìˆœ
    } catch {
      setLogs([]);
    }
  };
  
  const handleClearAll = () => {
    if (window.confirm('ëª¨ë“  ì—ëŸ¬ ë¡œê·¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      localStorage.removeItem('error_logs');
      setLogs([]);
    }
  };
  
  const handleCopyLog = (log: ErrorLog) => {
    navigator.clipboard.writeText(JSON.stringify(log, null, 2));
    alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
  };
  
  const handleCopyAll = () => {
    navigator.clipboard.writeText(JSON.stringify(logs, null, 2));
    alert('ì „ì²´ ë¡œê·¸ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆìŠµë‹ˆë‹¤');
  };
  
  return (
    <div className="p-6 max-w-4xl mx-auto">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-2xl font-bold">ë””ë²„ê·¸ íŒ¨ë„</h1>
        <div className="flex gap-2">
          {logs.length > 0 && (
            <>
              <Button onClick={handleCopyAll} variant="secondary" size="sm">
                ì „ì²´ ë³µì‚¬
              </Button>
              <Button onClick={handleClearAll} variant="secondary" size="sm">
                ì „ì²´ ì§€ìš°ê¸°
              </Button>
            </>
          )}
        </div>
      </div>
      
      <div className="mb-6">
        <GlassCard className="p-4">
          <p className="text-sm text-gray-600">
            ì´ <span className="font-bold text-brand-primary">{logs.length}</span>ê°œì˜ ì—ëŸ¬ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤
          </p>
        </GlassCard>
      </div>
      
      {logs.length === 0 ? (
        <GlassCard className="p-8 text-center text-gray-500">
          âœ… ì—ëŸ¬ ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤
        </GlassCard>
      ) : (
        <div className="space-y-4">
          {logs.map((log, index) => (
            <GlassCard key={index} className="p-4">
              <div className="flex justify-between items-start mb-2">
                <div>
                  <p className="text-xs text-gray-500">{log.timestamp}</p>
                  {log.type && (
                    <span className="text-xs bg-red-100 text-red-600 px-2 py-0.5 rounded">
                      {log.type}
                    </span>
                  )}
                </div>
                <button
                  onClick={() => handleCopyLog(log)}
                  className="text-xs text-blue-500 hover:underline"
                >
                  ë³µì‚¬
                </button>
              </div>
              <p className="font-mono text-sm text-red-600 mb-2 break-words">
                {log.message}
              </p>
              {log.source && (
                <p className="text-xs text-gray-600">
                  ğŸ“ {log.source}:{log.line}:{log.column}
                </p>
              )}
              {log.url && (
                <p className="text-xs text-gray-500 truncate">
                  ğŸ”— {log.url}
                </p>
              )}
              {log.stack && (
                <details className="mt-2">
                  <summary className="text-xs text-gray-500 cursor-pointer hover:text-gray-700">
                    ğŸ“‹ ìŠ¤íƒ ì¶”ì  ë³´ê¸°
                  </summary>
                  <pre className="text-xs bg-gray-100 p-2 mt-2 overflow-x-auto rounded">
                    {log.stack}
                  </pre>
                </details>
              )}
            </GlassCard>
          ))}
        </div>
      )}
    </div>
  );
};
```

**ë¼ìš°íŠ¸ ì¶”ê°€**: [`src/router/routes.tsx`](src/router/routes.tsx)

```typescript
// import ì¶”ê°€
const DebugPanel = lazy(() => import('../pages/profile/DebugPanel').then(m => ({ default: m.DebugPanel })));

// Profile ë¼ìš°íŠ¸ ê·¸ë£¹ì— ì¶”ê°€
<Route path="profile/debug" element={<LoadingWrapper><DebugPanel /></LoadingWrapper>} />
```

**ì ‘ê·¼ ë°©ë²•**: ë¸Œë¼ìš°ì €ì—ì„œ `/profile/debug` ì§ì ‘ ì…ë ¥

**ì»¤ë°‹**:

```bash
git add src/pages/profile/DebugPanel.tsx src/router/routes.tsx
git commit -m "feat(frontend): add DebugPanel page for error logs"
```

---

## ê²€ì¦ ë° í…ŒìŠ¤íŠ¸

### ë¹Œë“œ í…ŒìŠ¤íŠ¸

```bash
npm run build
npm run lint
npx tsc --noEmit
```

### ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] 1. ì‚¬ìƒí™œ ë³´í˜¸ ëª¨ë“œì—ì„œ ì˜¨ë³´ë”© ì§„í–‰ (3íšŒ ë¦¬ë‹¤ì´ë ‰íŠ¸ í›„ í†µê³¼)
- [ ] 2. DayMode/NightModeì— 10000ì ì´ˆê³¼ ì…ë ¥ (ë§‰í˜ í™•ì¸)
- [ ] 3. ë„¤íŠ¸ì›Œí¬ ëŠê¸° â†’ ì˜¤í”„ë¼ì¸ ë°°ë„ˆ í‘œì‹œ í™•ì¸
- [ ] 4. ê°•ì œ ì—ëŸ¬ ë°œìƒ â†’ localStorage ë¡œê¹… í™•ì¸
- [ ] 5. `/profile/debug` ì ‘ê·¼ â†’ ì—ëŸ¬ ë¡œê·¸ í‘œì‹œ í™•ì¸
- [ ] 6. ìœ„ê¸° í‚¤ì›Œë“œ ì…ë ¥ â†’ Gemini 2ì°¨ ê²€ì¦ í™•ì¸
- [ ] 7. ëŒ€í™” 100ê°œ ì´ìƒ ì…ë ¥ â†’ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸

### ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

```bash
# Chrome DevTools â†’ Performance
# 1. ëŒ€í™” 100ê°œ ì…ë ¥
# 2. ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼ë§
# 3. messages ë°°ì—´ í¬ê¸° 100ê°œ ì´í•˜ í™•ì¸
```

---

## Day 3: P1 íƒ€ì… í™•ì¥ (Phase 1 ì¤€ë¹„, 0.5ì¼)

### Task 3.1: CoachPersona íƒ€ì… í™•ì¥ (2ì‹œê°„)

**íŒŒì¼**: [`types.ts`](types.ts)

**ë¬¸ì œ**: FE-H13 - PRD ëª…ì„¸ì™€ ì‹¤ì œ íƒ€ì… ë¶ˆì¼ì¹˜
- humor, expertise í•„ë“œ ì—†ìŒ
- id, userId, timestamps ì—†ìŒ
- mbti vs mbtiType ë¶ˆì¼ì¹˜

**ìˆ˜ì •**:

```typescript
// types.tsì— ì¶”ê°€

// 1. MBTIType enum ì •ì˜
export type MBTIType = 
  | 'ENFP' | 'ENFJ' | 'ENTP' | 'ENTJ'
  | 'INFP' | 'INFJ' | 'INTP' | 'INTJ'
  | 'ESFP' | 'ESFJ' | 'ESTP' | 'ESTJ'
  | 'ISFP' | 'ISFJ' | 'ISTP' | 'ISTJ';

// 2. ê¸°ì¡´ CoachPersona ìœ ì§€ (í•˜ìœ„ í˜¸í™˜)
export interface CoachPersona {
  name: string;
  role: 'friend' | 'mentor' | 'counselor';
  mbti: string;
  traits: {
    warmth: number;
    directness: number;
  };
}

// 3. í™•ì¥ ë²„ì „ ì¶”ê°€ (PRD ëª…ì„¸ ì™„ì „ êµ¬í˜„, Phase 1ìš©)
export interface CoachPersonaExtended {
  id: string;
  userId: string;
  name: string;
  mbtiType: MBTIType;
  personality: {
    warmth: number;      // 0-100
    directness: number;  // 0-100
    humor: number;       // 0-100
    expertise: number;   // 0-100
  };
  speechStyle: 'formal' | 'informal';
  relationship: 'friend' | 'mentor' | 'counselor';
  avatar?: string;
  createdAt: Date;
  updatedAt: Date;
}

// 4. ë³€í™˜ ìœ í‹¸ë¦¬í‹° (ê¸°ì¡´ â†’ í™•ì¥)
export function toExtendedPersona(
  basic: CoachPersona, 
  userId: string
): CoachPersonaExtended {
  return {
    id: `persona_${Date.now()}`,
    userId,
    name: basic.name,
    mbtiType: basic.mbti as MBTIType,
    personality: {
      warmth: basic.traits.warmth,
      directness: basic.traits.directness,
      humor: 50,      // ê¸°ë³¸ê°’
      expertise: 50,  // ê¸°ë³¸ê°’
    },
    speechStyle: 'informal',
    relationship: basic.role,
    createdAt: new Date(),
    updatedAt: new Date(),
  };
}
```

**í…ŒìŠ¤íŠ¸**:
```typescript
// ê¸°ì¡´ ì½”ë“œ ì •ìƒ ì‘ë™ í™•ì¸ (í•˜ìœ„ í˜¸í™˜)
const basic: CoachPersona = {
  name: 'ë£¨ë‚˜',
  role: 'friend',
  mbti: 'ENFP',
  traits: { warmth: 80, directness: 40 }
};

// í™•ì¥ ë²„ì „ ë³€í™˜
const extended = toExtendedPersona(basic, 'user_123');
console.log(extended.personality.humor); // 50
```

**ì»¤ë°‹**:
```bash
git add types.ts
git commit -m "feat(types): extend CoachPersona for Phase 1 (FE-H13)"
```

---

## ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Critical (P0) - 5ê°œ

- [ ] FE-C1: OnboardingGuard sessionStorage í´ë°± (1.5ì‹œê°„)
- [ ] FE-C2: Firebase Auth ì¬ì‹œë„ UI (1.5ì‹œê°„)
- [ ] FE-C3: window.onerror í•¸ë“¤ëŸ¬ (1ì‹œê°„)
- [ ] FE-C4: ìœ„ê¸° ê°ì§€ Gemini API í†µí•© (3ì‹œê°„)
- [ ] FE-H2: DayMode ë©”ì‹œì§€ ë°°ì—´ ì œí•œ (30ë¶„)

### High (P1) - 1ê°œ (Phase 1 ì¤€ë¹„)

- [ ] FE-H13: CoachPersona íƒ€ì… í™•ì¥ (2ì‹œê°„)

### ê²€ì¦

- [ ] ë¹Œë“œ ì„±ê³µ
- [ ] Linter ì—ëŸ¬ 0ê°œ
- [ ] TypeScript ì—ëŸ¬ 0ê°œ
- [ ] ìˆ˜ë™ í…ŒìŠ¤íŠ¸ 7ê°œ í•­ëª© í†µê³¼
- [ ] ê¸°ì¡´ CoachPersona ì‚¬ìš©ì²˜ ì •ìƒ ì‘ë™ (í•˜ìœ„ í˜¸í™˜)

---

**ì´ ì˜ˆìƒ ì‹œê°„**: 10.5ì‹œê°„ (P0 8.5ì‹œê°„ + P1 2ì‹œê°„)

**ê¶Œì¥ ì¼ì •**: 2.5ì¼ (P0 2ì¼ + P1 0.5ì¼)

**ë‹¤ìŒ ë‹¨ê³„**: ë°±ì—”ë“œ íƒ€ì„ì•„ì›ƒ ìˆ˜ì • í›„ í”„ë¡œë•ì…˜ ë°°í¬
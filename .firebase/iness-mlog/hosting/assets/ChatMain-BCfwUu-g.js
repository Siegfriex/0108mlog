import{c as E,r as o,j as e,m as b,X as Z,C as pe,M as fe,B as y,a as ye,b as ge,S as q,d as be,A as D,e as ie,s as G,f as W,g as B,h as H,i as je,E as v,k as ae,l as le,F as re,n as we,o as Ne,p as ve,q as Ae,u as Se,t as ke,N as Ce}from"./index-SGZV-D-Q.js";import{G as U}from"./GlassCard-Cp0ExjZJ.js";import{T as Te}from"./trending-up-BWt1fibC.js";import{V as Me}from"./VoicePlayer-BQowizPl.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Ee=E("arrow-up",Ie);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]],oe=E("cloud-rain",_e);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],ce=E("flame",ze);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M5 12h14",key:"1ays0h"}]],$e=E("minus",Re);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Le=E("plus",Oe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Fe=E("rotate-ccw",Pe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],We=E("star",Ge);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],He=E("tag",Be);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],qe=E("trending-down",Ye),De=(t,n)=>{const i=n===0||n===6,s=[];return t>=6&&t<9?s.push("아침","출근 전"):t>=9&&t<12?(s.push("오전","업무"),i||s.push("회의")):t>=12&&t<14?s.push("점심","식사"):t>=14&&t<18?s.push("오후","업무"):t>=18&&t<22?s.push("저녁","퇴근 후"):s.push("밤","휴식"),n===1&&s.push("월요일"),i&&s.push("주말"),s.slice(0,3)},Ue=t=>{if(!t)return[];const n=[];return t.placeType==="work"?n.push("회사","업무","동료"):t.placeType==="home"?n.push("집","홈","가족"):n.push("외출","이동"),n.slice(0,3)},Ve=["출근","퇴근","회의","업무","점심","저녁","아침","밤","주말","휴식","운동","독서","가족","친구","혼자","스트레스","기쁨","평온","불안","슬픔","분노","피곤","에너지","집중"],Xe=({onTagsChange:t,initialTags:n=[],locationPermission:i="default"})=>{const[s,m]=o.useState(n),[r,d]=o.useState([]),[c,f]=o.useState(null),[p,A]=o.useState(!1),[j,S]=o.useState("");o.useEffect(()=>{(async()=>{const g=new Date,N=g.getHours(),h=g.getDay(),T=De(N,h);d(T),i==="granted"&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(_=>{const O={latitude:_.coords.latitude,longitude:_.coords.longitude,placeType:N>=9&&N<18&&h>=1&&h<=5?"work":"other"};f(O);const L=Ue(O);d(X=>[...X,...L].slice(0,3))},_=>{console.warn("위치 감지 실패:",_)},{enableHighAccuracy:!1,timeout:5e3,maximumAge:6e4})})()},[i]);const C=a=>{if(s.includes(a)){const g=s.filter(N=>N!==a);m(g),t(g)}else if(s.length<3){const g=[...s,a];m(g),t(g)}},u=()=>{if(j.trim()&&s.length<3&&!s.includes(j.trim())){const a=[...s,j.trim()];m(a),t(a),S(""),A(!1)}},x=a=>{const g=s.filter(N=>N!==a);m(g),t(g)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 text-sm mb-1",children:"상황 태그"}),e.jsx("p",{className:"text-xs text-slate-500",children:"오늘은 어떤 상황이었나요? (선택사항, 최대 3개)"})]}),s.length>0&&e.jsxs("span",{className:"text-xs font-bold text-brand-primary",children:[s.length,"/3"]})]}),s.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(a=>e.jsxs(b.div,{initial:{scale:0},animate:{scale:1},className:"flex items-center gap-2 px-3 py-1.5 bg-brand-primary text-white rounded-full text-sm font-medium",children:[e.jsx(He,{size:14}),e.jsx("span",{children:a}),e.jsx("button",{onClick:()=>x(a),className:"hover:bg-white/20 rounded-full p-0.5 transition-colors","aria-label":`${a} 태그 제거`,children:e.jsx(Z,{size:14})})]},a))}),r.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{size:14,className:"text-slate-400"}),e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"추천 태그"}),c&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-slate-300",children:"•"}),e.jsx(fe,{size:14,className:"text-slate-400"}),e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"위치 기반"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.filter(a=>!s.includes(a)).map(a=>e.jsx(b.button,{onClick:()=>C(a),whileHover:{scale:1.05},whileTap:{scale:.95},disabled:s.length>=3,className:`
                    px-3 py-1.5 rounded-full text-sm font-medium
                    transition-all duration-300
                    ${s.length>=3?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-white/80 border border-white/60 text-slate-700 hover:bg-brand-light hover:border-brand-primary/30"}
                  `,children:a},a))})]}),s.length<3&&e.jsx("div",{children:p?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:j,onChange:a=>S(a.target.value),onKeyPress:a=>a.key==="Enter"&&u(),placeholder:"태그 입력 (최대 10자)",maxLength:10,className:"flex-1 px-3 py-2 rounded-lg bg-white/80 border border-white/60 focus:outline-none focus:ring-2 focus:ring-brand-primary/50 text-sm"}),e.jsx(y,{onClick:u,variant:"primary",disabled:!j.trim(),className:"!px-4 !py-2",children:"추가"}),e.jsx(y,{onClick:()=>{A(!1),S("")},variant:"ghost",className:"!px-4 !py-2",children:"취소"})]}):e.jsxs("button",{onClick:()=>A(!0),className:"flex items-center gap-2 px-3 py-1.5 text-sm text-slate-500 hover:text-brand-primary transition-colors",children:[e.jsx(Le,{size:14}),e.jsx("span",{children:"직접 입력하기"})]})}),s.length<3&&!p&&e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-slate-400 hover:text-slate-600 mb-2",children:"더 많은 태그 보기"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Ve.filter(a=>!s.includes(a)&&!r.includes(a)).slice(0,12).map(a=>e.jsx("button",{onClick:()=>C(a),disabled:s.length>=3,className:`
                    px-2 py-1 rounded-md text-xs
                    transition-all duration-300
                    ${s.length>=3?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-slate-50 text-slate-600 hover:bg-brand-light hover:text-brand-primary"}
                  `,children:a},a))})]})]})},Je=({className:t="",onCheckIn:n,onWeeklySummary:i,onTodayAction:s,onSafety:m})=>{const r=[{id:"checkin",label:"오늘 체크인",icon:e.jsx(ye,{size:16,strokeWidth:2}),onClick:n,color:"bg-brand-primary"},{id:"summary",label:"이번 주 요약",icon:e.jsx(ge,{size:16,strokeWidth:2}),onClick:i,color:"bg-brand-secondary"},{id:"action",label:"오늘 1개",icon:e.jsx(q,{size:16,strokeWidth:2}),onClick:s,color:"bg-brand-accent"},{id:"safety",label:"안전 도움",icon:e.jsx(be,{size:16,strokeWidth:2}),onClick:m,color:"bg-red-500"}];return e.jsx("div",{className:`flex gap-2 overflow-x-auto scrollbar-hide pb-2 ${t}`,children:r.map(d=>e.jsxs(b.button,{onClick:d.onClick,whileHover:{scale:1.05},whileTap:{scale:.95},className:`
            flex items-center gap-2 px-4 py-2.5 rounded-full
            ${d.color} text-white
            font-bold text-xs
            whitespace-nowrap
            shadow-sm hover:shadow-md
            transition-all duration-300
            min-w-[100px]
            h-12
          `,children:[d.icon,e.jsx("span",{children:d.label})]},d.id))})},Ke=({actionTitle:t,onComplete:n,onSkip:i})=>{const[s,m]=o.useState("before"),[r,d]=o.useState(null),[c,f]=o.useState(null),p=x=>{d(x),m("after")},A=x=>{f(x),m("result")},j=()=>{m("after"),f(null)},S=()=>{r!==null&&c!==null&&n(r,c)},u=r===null||c===null?null:c-r;return e.jsx("div",{className:"w-full max-w-md mx-auto space-y-6",children:e.jsxs(D,{mode:"wait",children:[s==="before"&&e.jsxs(b.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"bg-white/80 backdrop-blur-xl rounded-2xl p-6 border border-white/60 shadow-lg",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-2",children:"액션 시작 전"}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"지금 감정 강도는 어느 정도인가요?"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"강도"}),e.jsxs("span",{className:"text-xl font-bold text-brand-primary",children:[r!==null?r:"-","/10"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",value:r||5,onChange:x=>d(Number(x.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-brand-primary"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-400",children:[e.jsx("span",{children:"1"}),e.jsx("span",{children:"5"}),e.jsx("span",{children:"10"})]}),e.jsx(y,{onClick:()=>p(r||5),variant:"primary",className:"w-full",children:"다음 단계로"}),i&&e.jsx(y,{onClick:i,variant:"ghost",className:"w-full",children:"스킵"})]})]},"before"),s==="after"&&e.jsxs(b.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"bg-white/80 backdrop-blur-xl rounded-2xl p-6 border border-white/60 shadow-lg",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-2",children:"액션 완료 후"}),e.jsxs("p",{className:"text-sm text-slate-600 mb-6",children:[t,"를 완료한 후 감정 강도는 어느 정도인가요?"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"강도"}),e.jsxs("span",{className:"text-xl font-bold text-brand-primary",children:[c!==null?c:"-","/10"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",value:c||r||5,onChange:x=>f(Number(x.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-brand-primary"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-400",children:[e.jsx("span",{children:"1"}),e.jsx("span",{children:"5"}),e.jsx("span",{children:"10"})]}),e.jsx(y,{onClick:()=>A(c||r||5),variant:"primary",className:"w-full",children:"결과 보기"}),e.jsxs(y,{onClick:j,variant:"ghost",className:"w-full",children:[e.jsx(Fe,{size:16,className:"mr-2"}),"5초 후 다시 체크"]})]})]},"after"),s==="result"&&u!==null&&e.jsxs(b.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.05},className:"bg-white/80 backdrop-blur-xl rounded-2xl p-6 border border-white/60 shadow-lg",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-2 text-center",children:"변화 결과"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 my-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-slate-700 mb-1",children:r}),e.jsx("div",{className:"text-xs text-slate-500",children:"Before"})]}),e.jsxs("div",{className:`
                flex items-center gap-2 px-4 py-2 rounded-full
                ${u>0?"bg-green-100 text-green-700":u<0?"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-700"}
              `,children:[u>0?e.jsx(Te,{size:24}):u<0?e.jsx(qe,{size:24}):e.jsx($e,{size:24}),e.jsx("span",{className:"text-xl font-bold",children:u>0?`+${u}`:u})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-slate-700 mb-1",children:c}),e.jsx("div",{className:"text-xs text-slate-500",children:"After"})]})]}),e.jsx("div",{className:"text-center mb-6",children:u>0?e.jsxs("p",{className:"text-sm text-green-700 font-medium",children:["감정 강도가 ",u,"점 상승했어요"]}):u<0?e.jsxs("p",{className:"text-sm text-blue-700 font-medium",children:["감정 강도가 ",Math.abs(u),"점 하락했어요"]}):e.jsx("p",{className:"text-sm text-slate-600 font-medium",children:"감정 강도가 유지되었어요"})}),e.jsxs(y,{onClick:S,variant:"primary",className:"w-full",children:[e.jsx(ie,{size:18,className:"mr-2"}),"완료"]})]},"result")]})})},Qe=[{id:"MA-001",title:"2분 박스 호흡",description:"4초 들이마시기 → 4초 멈춤 → 4초 내쉬기 → 4초 멈춤. 4번 반복.",duration:"2 min",type:"breathing"},{id:"MA-002",title:"4-6 호흡(긴 내쉬기)",description:"4초 들이마시고 6초 내쉬기. 8번 반복.",duration:"2 min",type:"breathing"},{id:"MA-003",title:"긴 내쉬기 10번",description:'숨을 편하게 들이마신 뒤, 내쉬는 호흡을 "조금 더 길게" 10번.',duration:"2 min",type:"breathing"},{id:"MA-004",title:"5-4-3-2-1 감각 체크",description:"보이는 것 5개, 만져지는 것 4개, 들리는 것 3개, 냄새 2개, 맛 1개를 조용히 확인.",duration:"3 min",type:"breathing"},{id:"MA-005",title:"손을 가슴에(자기 체크)",description:'한 손을 가슴에 두고 "지금 이 순간"에 집중하며 호흡 10번.',duration:"2 min",type:"breathing"},{id:"MA-006",title:"1분 바디 스캔 + 1분 호흡",description:"머리→어깨→가슴→배→다리 순서로 긴장 부위를 찾고, 마지막 1분은 호흡만.",duration:"2 min",type:"breathing"},{id:"MA-007",title:"3문장 마음 정리",description:'"지금 느끼는 감정은 ___.", "몸은 ___.", "다음에 필요한 건 ___." 3문장만 작성.',duration:"3 min",type:"breathing"},{id:"MA-008",title:"어깨/목 풀기(3분)",description:"어깨를 10번 돌리고, 목을 좌/우 천천히 10초씩. 마지막에 깊게 기지개.",duration:"3 min",type:"exercise"},{id:"MA-009",title:"3분 걷기",description:"집/사무실에서라도 3분만 천천히 걷기. 걸으며 발바닥 감각에 집중.",duration:"3 min",type:"exercise"},{id:"MA-010",title:"전신 기지개 2분",description:"팔을 머리 위로 올려 10초 유지 → 옆구리 늘리기 좌/우 → 몸통 비틀기.",duration:"2 min",type:"exercise"},{id:"MA-011",title:"손목/등 스트레칭",description:"손목을 가볍게 풀고, 등(견갑)을 30초씩 늘리기.",duration:"2 min",type:"exercise"},{id:"MA-012",title:"제자리 걷기(4분)",description:"1분 제자리 걷기 + 30초 쉬기 × 2세트. 숨이 너무 차지 않게.",duration:"4 min",type:"exercise"},{id:"MA-013",title:"물 한 잔 + 자세 리셋",description:"물 한 잔 마시고, 의자에 앉아 골반/등/목을 곧게 30초 유지.",duration:"3 min",type:"exercise"},{id:"MA-014",title:"감정 이름 붙이기",description:'"나는 지금 ___을 느낀다" 한 줄 + 이유(한 줄)만.',duration:"2 min",type:"journaling"},{id:"MA-015",title:"오늘 잘한 것 1개",description:'오늘 내가 한 "작은 성공" 1가지만 적기.',duration:"2 min",type:"journaling"},{id:"MA-016",title:"감사 1줄",description:"감사한 것 1개를 1줄로 적기(사람/상황/나 자신).",duration:"2 min",type:"journaling"},{id:"MA-017",title:'다음 "가장 작은 한 걸음"',description:'지금 해야 할 일/목표가 있다면 "5분 안에 가능한 1단계"를 적고, 시작 버튼만 누르기(실행은 선택).',duration:"3 min",type:"journaling"},{id:"MA-018",title:"머릿속 비우기 3줄",description:'떠오르는 생각을 3줄로 적고, 마지막 줄에 "지금은 여기까지"라고 마무리.',duration:"3 min",type:"journaling"},{id:"MA-019",title:"걱정 타임박스",description:'걱정을 2분 동안 적고, 마지막 1분은 "다음에 할 수 있는 1개"만 적기.',duration:"3 min",type:"journaling"},{id:"MA-020",title:"오늘의 우선순위 1개",description:"오늘 가장 중요한 것 1개만 정하고, 나머지는 잠시 내려놓기.",duration:"2 min",type:"journaling"},{id:"MA-021",title:"하루 마무리 한 줄",description:'"오늘의 나에게 한 줄"을 쓰기.',duration:"2 min",type:"journaling"},{id:"MA-022",title:"고마움 메시지 1개",description:'고마운 사람에게 짧게 "고마웠어" 한 문장 보내기(길게 X).',duration:"2 min",type:"mindfulness"},{id:"MA-023",title:"나에게 응원 한 줄",description:'"나는 지금도 충분히 하고 있어"처럼 나에게 한 문장.',duration:"2 min",type:"mindfulness"},{id:"MA-024",title:"안부 한 줄(가벼운 연결)",description:"부담 없는 안부 1줄 보내기(답을 기대하지 않기).",duration:"3 min",type:"mindfulness"},{id:"MA-025",title:"미소/표정 풀기",description:"턱/미간 힘을 풀고, 어깨를 내리며 10초 미소.",duration:"2 min",type:"mindfulness"},{id:"MA-026",title:"책상 위 2분 정리",description:'눈에 보이는 3가지만 제자리로. 끝나면 "완료"만 누르기.',duration:"2 min",type:"mindfulness"},{id:"MA-027",title:"창문 열기 + 공기 바꾸기",description:"창문을 열고 10번 천천히 호흡. 창문이 없다면 자리에서 몸을 펴기.",duration:"2 min",type:"mindfulness"},{id:"MA-028",title:"빛/소리 세팅",description:"화면 밝기/조명 조정, 불필요한 알림 끄기(10분만).",duration:"3 min",type:"mindfulness"},{id:"MA-029",title:"내일을 위한 1분 준비",description:"내일의 첫 할 일 1개를 적고(1분), 필요한 것 1가지만 꺼내두기(2분).",duration:"3 min",type:"journaling"},{id:"MA-030",title:"좋아하는 음악 1곡",description:"좋아하는 음악 1곡을 들으며 호흡/몸 감각만 느끼기.",duration:"3 min",type:"mindfulness"}],I=t=>Qe.filter(n=>n.type===t),Ze=t=>t>=8?I("breathing").slice(0,3):t>=5?[...I("breathing").slice(0,2),...I("exercise").slice(0,2)]:[...I("journaling").slice(0,2),...I("mindfulness").slice(0,2)],et=(t,n)=>{const i=Ze(n);return t==="JOY"||t==="PEACE"?[...I("mindfulness").slice(0,2),...I("journaling").slice(0,2),...i.slice(0,1)]:t==="ANXIETY"||t==="SADNESS"?[...I("journaling").slice(0,2),...I("mindfulness").slice(0,2),...i.slice(0,1)]:i},Y={CONVERSATIONS:"conversations",MESSAGES:"messages",EMOTIONS:"emotions",DIARIES:"diaries",USER_PROFILES:"userProfiles",MICRO_ACTIONS:"microActions",WEEKLY_REPORTS:"weeklyReports",MONTHLY_REPORTS:"monthlyReports",CONTENTS:"contents",TIMELINE:"timeline"};function V(){const t=je.currentUser;if(!t)throw new Error("User must be authenticated to save data");return t.uid}async function tt(t){try{const n=V(),i=G(),s={userId:n,title:t.title,createdAt:i,updatedAt:i,messageCount:t.messages.length,emotion:t.emotion,intensity:t.intensity,modeAtTime:t.modeAtTime,contextTags:t.contextTags},m=await W(B(H,Y.CONVERSATIONS),s),r=B(H,Y.MESSAGES);for(const d of t.messages)await W(r,{conversationId:m.id,role:d.role,content:d.content,timestamp:G()});return m.id}catch(n){throw console.error("Error saving conversation:",n),n}}async function st(t){try{const i={userId:V(),emotion:t.emotion,intensity:t.intensity,timestamp:G(),modeAtTime:t.modeAtTime,contextTags:t.contextTags,conversationId:t.conversationId,location:t.location};return(await W(B(H,Y.EMOTIONS),i)).id}catch(n){throw console.error("Error saving emotion entry:",n),n}}async function nt(t){try{const i={userId:V(),date:G(),content:t.content,emotion:t.emotion,intensity:t.intensity,dayModeSummary:t.dayModeSummary,letterContent:t.letterContent,letterGeneratedAt:t.letterContent?G():void 0,conversationId:t.conversationId};return(await W(B(H,Y.DIARIES),i)).id}catch(n){throw console.error("Error saving diary entry:",n),n}}async function it(t){try{const i={userId:V(),actionId:t.actionId,actionTitle:t.actionTitle,executedAt:G(),beforeIntensity:t.beforeIntensity,afterIntensity:t.afterIntensity,completed:t.completed,skipped:t.skipped};return(await W(B(H,Y.MICRO_ACTIONS),i)).id}catch(n){throw console.error("Error saving micro action log:",n),n}}const ne=[{id:v.JOY,label:"Super Awesome",icon:e.jsx(ae,{size:36,strokeWidth:2}),color:"text-amber-500",bgGradient:"from-amber-200/40 via-yellow-100/40 to-orange-100/40"},{id:v.PEACE,label:"Pretty Good",icon:e.jsx(le,{size:36,strokeWidth:2}),color:"text-brand-primary",bgGradient:"from-brand-secondary/40 via-teal-100/40 to-cyan-100/40"},{id:v.ANXIETY,label:"A bit Anxious",icon:e.jsx(re,{size:36,strokeWidth:2}),color:"text-orange-500",bgGradient:"from-orange-200/40 via-red-100/40 to-amber-100/40"},{id:v.SADNESS,label:"Feeling Blue",icon:e.jsx(oe,{size:36,strokeWidth:2}),color:"text-indigo-500",bgGradient:"from-indigo-200/40 via-purple-100/40 to-slate-100/40"},{id:v.ANGER,label:"Frustrated",icon:e.jsx(ce,{size:36,strokeWidth:2}),color:"text-rose-500",bgGradient:"from-rose-200/40 via-red-100/40 to-orange-100/40"}],at=({persona:t,onSave:n,setImmersive:i,onNavigateToReports:s,onOpenSafety:m})=>{const[r,d]=o.useState([]),[c,f]=o.useState(null),[p,A]=o.useState(5),[j,S]=o.useState(""),[C,u]=o.useState(!1),[x,a]=o.useState(null),[g,N]=o.useState(!1),[h,T]=o.useState(!1),[_,O]=o.useState(!1),[L,X]=o.useState(!1),[z,de]=o.useState([]),[J,K]=o.useState(!1),ee=o.useRef(null),P=o.useRef(null),me=()=>{var l;(l=ee.current)==null||l.scrollIntoView({behavior:"smooth"})};o.useEffect(me,[r,C]),o.useEffect(()=>()=>{i(!1),P.current&&clearTimeout(P.current)},[i]);const M=ne.find(l=>l.id===c),xe=()=>{if(!c)return;O(!0);const l={id:"init",role:"assistant",content:`I noticed you're feeling ${M==null?void 0:M.label} today. What's on your mind?`,timestamp:new Date};d([l])},te=async()=>{if(!j.trim())return;const l={id:Date.now().toString(),role:"user",content:j,timestamp:new Date};d(w=>[...w,l]),S(""),u(!0);const R=r.map(w=>`${w.role==="사용자"?"사용자":t.name}: ${w.content}`),$=new Promise(w=>{P.current=setTimeout(()=>{w("분석에 시간이 걸리고 있어요. 잠시 후 다시 시도해주세요.")},8e3)});try{const w=Ne(l.content,R,t),k=await Promise.race([w,$]),F={id:(Date.now()+1).toString(),role:"assistant",content:k,timestamp:new Date};d(he=>[...he,F])}catch(w){console.error("AI 응답 생성 오류:",w);const k={id:(Date.now()+1).toString(),role:"assistant",content:"연결에 문제가 발생했습니다. 잠시 후 다시 시도해주세요.",timestamp:new Date};d(F=>[...F,k])}finally{P.current&&(clearTimeout(P.current),P.current=null),u(!1)}},Q=async()=>{if(L||g)return;if(!J&&z.length===0){K(!0);return}X(!0),i(!1);const l=c||v.PEACE,R=r.length>1?r[1].content.slice(0,30):"Check-in",$=r.map(k=>`[${k.role==="user"?"Me":t.name}]: ${k.content}`).join(`

`),w={id:Date.now().toString(),date:new Date,type:"day",emotion:l,intensity:p,summary:R,detail:$,nuanceTags:z};try{const k=await tt({title:R,messages:r.map(F=>({role:F.role,content:F.content})),emotion:l,intensity:p,modeAtTime:"day",contextTags:z.length>0?z:void 0});await st({emotion:l,intensity:p,modeAtTime:"day",contextTags:z.length>0?z:void 0,conversationId:k})}catch(k){console.error("Error saving to Firestore:",k)}n(w)},se=async()=>{if(!c)return;N(!0);const $=et(c,p)[0]||await we(c,p,r.map(w=>w.content).join(" "));a($),N(!1)},ue=async(l,R)=>{if(x)try{await it({actionId:x.id,actionTitle:x.title,beforeIntensity:l,afterIntensity:R,completed:!0,skipped:!1})}catch($){console.error("Error saving micro action log:",$)}T(!1),a(null)};return _?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[M&&e.jsx("div",{className:`${M.color}`,children:M.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-lg",children:M==null?void 0:M.label}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Intensity: ",p,"/10"]})]})]}),e.jsx("button",{onClick:()=>i(!1),className:"p-2 rounded-full hover:bg-white/20 transition-colors",children:e.jsx(Z,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 scrollbar-hide",children:[r.map(l=>e.jsx(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${l.role==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`
              max-w-[80%] rounded-2xl px-4 py-3
              ${l.role==="user"?"bg-brand-primary text-white":"bg-white/60 text-slate-900"}
            `,children:e.jsx("p",{className:"text-sm",children:l.content})})},l.id)),C&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white/60 rounded-2xl px-4 py-3",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-brand-primary rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-brand-primary rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-brand-primary rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),e.jsx("div",{ref:ee})]}),e.jsxs(D,{children:[x&&!L&&!h&&e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"p-4 border-t border-white/20",children:e.jsxs(U,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg mb-1",children:x.title}),e.jsx("p",{className:"text-sm text-slate-600",children:x.description})]}),e.jsx("button",{onClick:()=>a(null),"aria-label":"액션 카드 닫기",children:e.jsx(Z,{size:20,className:"text-slate-400"})})]}),e.jsxs(y,{variant:"primary",className:"w-full",onClick:()=>{T(!0)},children:["Try This (",x.duration,")"]})]})}),h&&x&&e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"p-4 border-t border-white/20",children:e.jsx(Ke,{actionTitle:x.title,onComplete:ue,onSkip:()=>{T(!1),a(null)}})})]}),J&&e.jsxs("div",{className:"p-4 border-t border-white/20 bg-white/40 backdrop-blur-md",children:[e.jsx(Xe,{onTagsChange:l=>{de(l)},initialTags:z,locationPermission:"granted"}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(y,{onClick:()=>{K(!1),Q()},variant:"primary",className:"flex-1",children:"저장하기"}),e.jsx(y,{onClick:()=>{K(!1),Q()},variant:"ghost",children:"스킵"})]})]}),!J&&e.jsxs("div",{className:"p-4 border-t border-white/20",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:j,onChange:l=>S(l.target.value),onKeyPress:l=>l.key==="Enter"&&te(),placeholder:"Tell me more...",className:"flex-1 px-4 py-3 rounded-full bg-white/60 border border-white/60 focus:outline-none focus:ring-2 focus:ring-brand-primary/50","aria-label":"메시지 입력"}),e.jsx(y,{onClick:te,variant:"primary","aria-label":"전송",children:e.jsx(Ee,{size:20})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(y,{onClick:Q,variant:"secondary",className:"flex-1",disabled:L,"aria-label":"체크인 완료 및 저장",children:L?"Saved!":"Finish & Save"}),e.jsx(y,{onClick:se,variant:"ghost",isLoading:g,"aria-label":"마이크로 액션 생성",children:e.jsx(q,{size:18})})]})]})]}):e.jsxs("div",{className:"pt-8 sm:pt-[15vh] px-4 sm:px-6",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold mb-2",children:"Check In"}),e.jsx("p",{className:"text-sm sm:text-base text-slate-600 mb-8",children:"How are you feeling right now?"}),e.jsx(Je,{className:"mb-6",onCheckIn:()=>{},onWeeklySummary:()=>{s==null||s()},onTodayAction:()=>{se()},onSafety:()=>{m==null||m()}}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 mb-8",children:ne.map(l=>e.jsxs(b.button,{onClick:()=>f(l.id),whileHover:{scale:1.05},whileTap:{scale:.95},className:`
                relative overflow-hidden rounded-2xl p-6
                ${c===l.id?`bg-gradient-to-br ${l.bgGradient} border-2 border-brand-primary shadow-lg`:"bg-white/50 border border-white/60 hover:bg-white/70"}
                transition-all duration-300
              `,children:[e.jsx("div",{className:`${l.color} mb-2 flex justify-center`,children:l.icon}),e.jsx("p",{className:`text-sm font-medium ${c===l.id?"text-slate-900":"text-slate-600"}`,children:l.label})]},l.id))}),c&&e.jsxs(U,{className:"mb-8",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-4",children:["Intensity: ",p,"/10"]}),e.jsx("input",{type:"range",min:"1",max:"10",value:p,onChange:l=>A(Number(l.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer"})]}),c&&e.jsx(y,{onClick:xe,className:"w-full",variant:"primary",children:"Start Check-in"})]})},lt=[{id:v.JOY,label:"Joy",icon:e.jsx(ae,{size:40,strokeWidth:1.5}),color:"joy"},{id:v.PEACE,label:"Peace",icon:e.jsx(le,{size:40,strokeWidth:1.5}),color:"peace"},{id:v.ANXIETY,label:"Anxiety",icon:e.jsx(re,{size:40,strokeWidth:1.5}),color:"anxiety"},{id:v.SADNESS,label:"Sadness",icon:e.jsx(oe,{size:40,strokeWidth:1.5}),color:"sadness"},{id:v.ANGER,label:"Anger",icon:e.jsx(ce,{size:40,strokeWidth:1.5}),color:"anger"}],rt=({persona:t,onSave:n})=>{const[i,s]=o.useState("emotion"),[m,r]=o.useState(null),[d,c]=o.useState(5),[f,p]=o.useState(""),[A,j]=o.useState(""),[S,C]=o.useState(!1),[u,x]=o.useState(!1),a=()=>{i==="emotion"&&m&&s("diary")},g=async()=>{if(!f.trim())return;C(!0);const h=await Ae(f,t);j(h),s("letter"),C(!1);const T=m||v.PEACE,_={id:Date.now().toString(),date:new Date,type:"night",emotion:T,intensity:d,summary:f.slice(0,40)+(f.length>40?"...":""),detail:`[감정]: ${T} (강도: ${d})
[나의 일기]
${f}

[${t.name}의 답장]
${h}`};try{await nt({content:f,emotion:T,intensity:d,letterContent:h})}catch(O){console.error("Error saving diary entry:",O)}n(_),x(!0),setTimeout(()=>x(!1),3e3)},N=()=>{s("emotion"),p(""),j(""),r(null),c(5)};return e.jsxs("div",{className:"w-full max-w-4xl mx-auto h-full flex flex-col px-4 text-white",children:[e.jsxs("div",{className:"py-6 shrink-0 text-center",children:[e.jsxs("h2",{className:"text-2xl font-serif font-bold flex items-center justify-center gap-2 mb-2 drop-shadow-md",children:[e.jsx("span",{className:"text-purple-300",children:e.jsx(We,{size:20,fill:"currentColor"})}),i==="emotion"?"Evening Reflection":i==="diary"?"Your Story":"A Letter for You"]}),e.jsx("p",{className:"text-white/60 text-sm font-medium",children:i==="emotion"?"How was your day feeling?":i==="diary"?"Let it all out. The night is listening.":`A message from ${t.name}`})]}),e.jsxs(D,{mode:"wait",children:[i==="emotion"&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex-1 flex flex-col justify-center items-center gap-8 max-w-2xl mx-auto w-full",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6 w-full",children:lt.map(h=>e.jsxs("button",{onClick:()=>r(h.id),className:`
                                aspect-square p-6 rounded-[32px] backdrop-blur-md border text-left transition-all duration-300 flex flex-col justify-center items-center gap-4 group
                                ${m===h.id?"bg-white/20 border-white/60 shadow-[0_0_40px_rgba(255,255,255,0.1)] scale-105 ring-1 ring-white/50":"bg-white/5 border-white/5 hover:bg-white/10"}
                            `,children:[e.jsx("span",{className:"text-white/80 group-hover:scale-110 transition-transform duration-300",children:h.icon}),e.jsx("span",{className:"text-white/90 font-medium text-lg tracking-wide",children:h.label})]},h.id))}),m&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/5 backdrop-blur-xl rounded-[32px] p-8 border border-white/10 w-full",children:[e.jsxs("div",{className:"flex justify-between text-white font-bold mb-6",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider text-purple-200",children:"Depth of Feeling"}),e.jsx("span",{className:"text-xl",children:d})]}),e.jsx("input",{type:"range",min:"1",max:"10",value:d,onChange:h=>c(Number(h.target.value)),className:"w-full h-2 bg-white/20 rounded-full appearance-none cursor-pointer accent-purple-300"}),e.jsxs(y,{onClick:a,className:"w-full mt-8 py-4 bg-purple-500 hover:bg-purple-600 border-none text-white font-bold text-lg shadow-xl shadow-purple-900/40",children:["Continue ",e.jsx(ve,{size:20})]})]})]},"step-emotion"),i==="diary"&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex-1 flex flex-col gap-6 w-full max-w-3xl mx-auto pb-10",children:[e.jsx(U,{className:"flex-1 !bg-black/20 !border-white/10 !rounded-[40px] overflow-hidden min-h-[400px] shadow-2xl backdrop-blur-md",children:e.jsx("textarea",{value:f,onChange:h=>p(h.target.value),placeholder:"Write about your day...",className:"w-full h-full bg-transparent resize-none focus:outline-none text-white placeholder:text-white/20 text-xl leading-relaxed p-4 font-serif",autoFocus:!0})}),e.jsxs(y,{onClick:g,isLoading:S,className:"w-full py-5 bg-gradient-to-r from-purple-600 to-indigo-600 shadow-lg border-none text-lg font-bold rounded-[24px]",children:[e.jsx(q,{className:"w-5 h-5 mr-2"}),"Send to Stars"]})]},"step-diary"),i==="letter"&&e.jsx(b.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"flex-1 flex flex-col h-full overflow-hidden pb-10 w-full max-w-3xl mx-auto",children:e.jsxs(U,{className:"h-full flex flex-col !bg-indigo-950/60 !border-white/10 !rounded-[40px] !p-8 shadow-2xl backdrop-blur-xl",children:[e.jsxs("div",{className:"flex justify-between items-start mb-8 shrink-0 pb-6 border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-indigo-500/50 flex items-center justify-center shadow-lg border border-white/10",children:e.jsx(q,{size:24,className:"text-purple-200"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-bold text-lg",children:["From. ",t.name]}),e.jsxs("span",{className:"text-indigo-300 text-xs font-medium uppercase tracking-wider",children:["AI ",t.role]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Me,{text:A})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-4 scrollbar-hide",children:e.jsx("div",{className:"prose prose-lg prose-invert prose-p:text-indigo-100 prose-p:leading-loose prose-p:font-light font-serif",children:e.jsx("p",{className:"whitespace-pre-wrap",children:A})})}),e.jsx("div",{className:"pt-6 mt-6 border-t border-white/5 shrink-0",children:e.jsx(y,{variant:"ghost",onClick:N,className:"w-full text-indigo-300 hover:text-white hover:bg-white/5 py-4 text-base",children:"Start New Entry"})})]})},"step-letter")]}),e.jsx(D,{children:u&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"fixed top-24 left-1/2 -translate-x-1/2 z-50 flex items-center gap-3 px-6 py-3 bg-emerald-500/90 backdrop-blur-xl text-white rounded-full shadow-2xl border border-white/20",children:[e.jsx(ie,{size:20}),e.jsx("span",{className:"font-bold text-sm",children:"Saved successfully"})]})})]})},xt=()=>{const t=Se(),n=ke();if(!t)return e.jsx(Ce,{to:"/",replace:!0});const{mode:i,persona:s,setIsImmersive:m,timelineData:r,setPersona:d}=t,c=A=>{},f=()=>{n("/reports/weekly")},p=()=>{n("/safety")};return i==="day"?e.jsx(at,{persona:s,onSave:c,setImmersive:m,onNavigateToReports:f,onOpenSafety:p}):e.jsx(rt,{persona:s,onSave:c})};export{xt as ChatMain};

import{D as S,G as p,T,H as n,I as R,J as g,K as l,M as I}from"./firebase-Br2-H2XF.js";import{i as s,j as O}from"./index-B81HDj9r.js";const i={CONVERSATIONS:"conversations",MESSAGES:"messages",EMOTIONS:"emotions",DIARIES:"diaries",USER_PROFILES:"userProfiles",MICRO_ACTIONS:"microActions",WEEKLY_REPORTS:"weeklyReports",MONTHLY_REPORTS:"monthlyReports",CONTENTS:"contents",TIMELINE:"timeline"};function d(){const e=O.currentUser;if(!e)throw new Error("User must be authenticated to save data");return e.uid}async function h(e){try{const r=d(),t=n(),o={userId:r,title:e.title,createdAt:t,updatedAt:t,messageCount:e.messages.length,emotion:e.emotion,intensity:e.intensity,modeAtTime:e.modeAtTime,contextTags:e.contextTags},a=await l(I(s,i.CONVERSATIONS),o),E=I(s,i.MESSAGES);for(const u of e.messages)await l(E,{conversationId:a.id,role:u.role,content:u.content,timestamp:n()});return a.id}catch(r){throw console.error("Error saving conversation:",r),r}}async function w(e){try{const t={userId:d(),emotion:e.emotion,intensity:e.intensity,timestamp:n(),modeAtTime:e.modeAtTime,contextTags:e.contextTags,conversationId:e.conversationId,location:e.location};return(await l(I(s,i.EMOTIONS),t)).id}catch(r){throw console.error("Error saving emotion entry:",r),r}}async function N(e){try{const t={userId:d(),date:n(),content:e.content,emotion:e.emotion,intensity:e.intensity,dayModeSummary:e.dayModeSummary,letterContent:e.letterContent,letterGeneratedAt:e.letterContent?n():void 0,conversationId:e.conversationId};return(await l(I(s,i.DIARIES),t)).id}catch(r){throw console.error("Error saving diary entry:",r),r}}async function C(e){try{const t={userId:d(),actionId:e.actionId,actionTitle:e.actionTitle,executedAt:n(),beforeIntensity:e.beforeIntensity,afterIntensity:e.afterIntensity,completed:e.completed,skipped:e.skipped};return(await l(I(s,i.MICRO_ACTIONS),t)).id}catch(r){throw console.error("Error saving micro action log:",r),r}}async function M(e){var r,t,o,a,E,u;try{const m=d(),f=S(s,i.USER_PROFILES,m),c=await p(f),y={updatedAt:n(),preferences:{...c.exists()?c.data().preferences:{},reminderEnabled:e.reminderEnabled??((t=(r=c.data())==null?void 0:r.preferences)==null?void 0:t.reminderEnabled)??!0,reminderTime:e.reminderTime??((a=(o=c.data())==null?void 0:o.preferences)==null?void 0:a.reminderTime)??"09:00",language:e.language??((u=(E=c.data())==null?void 0:E.preferences)==null?void 0:u.language)??"ko",...e.reminderFrequency&&{reminderFrequency:e.reminderFrequency},...e.autoDayNightMode!==void 0&&{autoDayNightMode:e.autoDayNightMode},...e.predictiveNudgeEnabled!==void 0&&{predictiveNudgeEnabled:e.predictiveNudgeEnabled},...e.snoozeUntil&&{snoozeUntil:T.fromDate(e.snoozeUntil)}}};c.exists()?await R(f,y):await g(f,{userId:m,persona:{name:"AI 동반자",mbti:"INFJ",tone:"warm",traits:[]},createdAt:n(),onboardingCompleted:!1,...y})}catch(m){throw console.error("Error saving user settings:",m),m}}async function b(){try{const e=d(),r=S(s,i.USER_PROFILES,e),t=await p(r);return t.exists()&&t.data().preferences||null}catch(e){throw console.error("Error getting user settings:",e),e}}export{h as a,w as b,N as c,M as d,b as g,C as s};

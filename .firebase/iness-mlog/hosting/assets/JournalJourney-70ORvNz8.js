import{j as e,A as f,m as u}from"./framer-motion-DyOGlghr.js";import{r as c,i as N,N as y}from"./react-vendor-toRuRpSQ.js";import{B as p,l as g,E as x,G as d}from"./index-DqV5LO6N.js";import{r as h,Q as v,C as j}from"./lucide-react-d6c8Yrq5.js";import"./firebase-tIcAbxpe.js";const b=()=>{const a=g();return{[x.JOY]:a.JOY,[x.PEACE]:a.PEACE,[x.ANXIETY]:a.ANXIETY,[x.SADNESS]:a.SADNESS,[x.ANGER]:a.ANGER}},w=(a,l)=>{if(a.length<2)return{nodes:[],links:[]};const s=Object.values(x).map(t=>({id:t,name:t,color:l[t]})),i={};for(let t=0;t<a.length-1;t++){const r=a[t].emotion,o=a[t+1].emotion;i[r]||(i[r]={}),i[r][o]=(i[r][o]||0)+1}const n=[];return Object.entries(i).forEach(([t,r])=>{Object.entries(r).forEach(([o,m])=>{m>0&&n.push({source:t,target:o,value:m})})}),{nodes:s,links:n}},k=a=>{const l=new Date().getFullYear(),s=new Date(l,0,1),i=new Date(l,11,31),n=[];for(let t=new Date(s);t<=i;t.setDate(t.getDate()+1)){const r=t.toISOString().split("T")[0],o=a.find(m=>new Date(m.date).toISOString().split("T")[0]===r);n.push({date:new Date(t),emotion:(o==null?void 0:o.emotion)||null,intensity:(o==null?void 0:o.intensity)||0})}return n},C=({timelineData:a})=>{const[l,s]=c.useState("timeline"),[i,n]=c.useState(new Date().getFullYear()),t=c.useMemo(()=>b(),[]),r=c.useMemo(()=>w(a,t),[a,t]),o=c.useMemo(()=>k(a),[a]);return e.jsxs("div",{className:"w-full h-full flex flex-col p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"감정 여정 시각화"}),e.jsx("p",{className:"text-sm text-slate-500",children:"나의 감정 변화를 다양한 방식으로 확인해보세요"})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs(p,{onClick:()=>s("timeline"),variant:l==="timeline"?"primary":"ghost",className:"flex-1",children:[e.jsx(h,{size:18,className:"mr-2"}),"타임라인"]}),e.jsxs(p,{onClick:()=>s("pixels"),variant:l==="pixels"?"primary":"ghost",className:"flex-1",children:[e.jsx(v,{size:18,className:"mr-2"}),"Year in Pixels"]}),e.jsxs(p,{onClick:()=>s("sankey"),variant:l==="sankey"?"primary":"ghost",className:"flex-1",children:[e.jsx(j,{size:18,className:"mr-2"}),"Sankey Flow"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide",children:e.jsxs(f,{mode:"wait",children:[l==="timeline"&&e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:e.jsx(D,{data:a,emotionColors:t})},"timeline"),l==="pixels"&&e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:e.jsx(E,{data:o,emotionColors:t})},"pixels"),l==="sankey"&&e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:e.jsx(S,{data:r,emotionColors:t})},"sankey")]})})]})},D=({data:a,emotionColors:l})=>e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:a.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(h,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"아직 기록된 감정이 없어요"})]}):a.map((s,i)=>e.jsxs("div",{className:"flex items-start gap-4 p-4 rounded-xl bg-white/50 hover:bg-white/70 transition-colors",children:[e.jsx("div",{className:"w-4 h-4 rounded-full shrink-0 mt-1",style:{backgroundColor:l[s.emotion]}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-bold text-slate-900",children:new Date(s.date).toLocaleDateString("ko-KR",{month:"short",day:"numeric"})}),e.jsxs("span",{className:"text-xs text-slate-500",children:["강도: ",s.intensity||0,"/10"]})]}),e.jsx("p",{className:"text-sm text-slate-600",children:s.summary}),s.nuanceTags&&s.nuanceTags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:s.nuanceTags.map(n=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-brand-light text-brand-primary rounded-full",children:n},n))})]})]},s.id))})}),E=({data:a,emotionColors:l})=>{const s=c.useMemo(()=>{const i={};return a.forEach(n=>{const t=n.date.getMonth();i[t]||(i[t]=[]),i[t].push(n)}),i},[a]);return e.jsx(d,{children:e.jsx("div",{className:"space-y-6",children:Object.entries(s).map(([i,n])=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 mb-3",children:[parseInt(i)+1,"월"]}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:n.map((t,r)=>e.jsx("div",{className:`
                    aspect-square rounded-sm
                    ${t.emotion?"opacity-80 hover:opacity-100 cursor-pointer transition-opacity":"bg-slate-100 opacity-30"}
                  `,style:{backgroundColor:t.emotion?l[t.emotion]:void 0},title:t.emotion?`${t.date.toLocaleDateString("ko-KR")}: ${t.emotion}`:void 0},r))})]},i))})})},S=({data:a,emotionColors:l})=>a.links.length===0?e.jsx(d,{children:e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(j,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"감정 전환 데이터가 부족해요"}),e.jsx("p",{className:"text-xs mt-2",children:"더 많은 기록을 남기면 패턴을 확인할 수 있어요"})]})}):e.jsx(d,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap gap-3 justify-center",children:a.nodes.map(s=>e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full",style:{backgroundColor:s.color+"20",border:`2px solid ${s.color}`},children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:s.color}}),e.jsx("span",{className:"text-sm font-medium text-slate-900",children:s.name})]},s.id))}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-700",children:"감정 전환 패턴"}),a.links.sort((s,i)=>i.value-s.value).map((s,i)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-white/50",children:[e.jsx("div",{className:"w-6 h-6 rounded-full",style:{backgroundColor:l[s.source]}}),e.jsx("span",{className:"text-sm text-slate-600",children:s.source}),e.jsx("div",{className:"flex-1 h-1 bg-gradient-to-r from-slate-200 to-slate-300 rounded-full relative",children:e.jsx("div",{className:"h-full rounded-full",style:{width:`${s.value/Math.max(...a.links.map(n=>n.value))*100}%`,backgroundColor:l[s.source]}})}),e.jsxs("span",{className:"text-xs font-bold text-slate-500",children:[s.value,"회"]}),e.jsx("div",{className:"w-6 h-6 rounded-full",style:{backgroundColor:l[s.target]}}),e.jsx("span",{className:"text-sm text-slate-600",children:s.target})]},i))]})]})}),I=()=>{const a=N();if(!a)return e.jsx(y,{to:"/",replace:!0});const{timelineData:l}=a;return e.jsx(C,{timelineData:l})};export{I as JournalJourney};

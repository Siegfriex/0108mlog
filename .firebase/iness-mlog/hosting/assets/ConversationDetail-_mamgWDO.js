import{j as e}from"./framer-motion-BL4N7xFA.js";import{r as l,i as g,d as v}from"./react-vendor-CHpw1G1i.js";import{F as N,t as b,G as j,B as D,q as S}from"./index-Dty_Gb9U.js";import{T as y,N as E,P as C,O as w,K as R,V as L,D as T,G as k}from"./firebase-BBl07Gss.js";import"./lucide-react-CKY1Dauo.js";function A(t){if(t instanceof y)return t.toDate();if(t instanceof Date)return t;if(typeof t=="string"||typeof t=="number"){const a=new Date(t);if(!isNaN(a.getTime()))return a}return new Date}const O=t=>{const[a,n]=l.useState([]),[x,o]=l.useState(!0),[m,i]=l.useState(null);return l.useEffect(()=>{if(!t){o(!1);return}const f=E(R(b,N.MESSAGES),w("conversationId","==",t),C("timestamp","asc")),u=L(f,c=>{try{const r=c.docs.map(d=>{const s=d.data();return{id:d.id,role:s.role||"user",content:s.content||"",timestamp:A(s.timestamp)}});n(r),o(!1),i(null)}catch(r){i(r instanceof Error?r:new Error("데이터 변환 오류")),o(!1)}},c=>{i(c),o(!1)});return()=>{u()}},[t]),{data:a,loading:x,error:m}},F=()=>{var r,d;const{id:t}=g(),a=v(),[n,x]=l.useState(null),[o,m]=l.useState(!0),{data:i,loading:f,error:u}=O(t);if(l.useEffect(()=>{(async()=>{if(!t){m(!1);return}try{const h=T(b,N.CONVERSATIONS,t),p=await k(h);p.exists()&&x({id:p.id,...p.data()})}catch(h){S("ConversationDetail.loadConversation",h)}finally{m(!1)}})()},[t]),o||f)return e.jsxs("div",{className:"h-full flex flex-col p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("button",{onClick:()=>a("/journal"),className:"p-2 hover:bg-slate-100 rounded-full transition-colors","aria-label":"뒤로 가기",children:"←"}),e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"대화 상세"})]}),e.jsx(j,{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-slate-600",children:"로딩 중..."})})})]});if(!n||u)return e.jsxs("div",{className:"h-full flex flex-col p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("button",{onClick:()=>a("/journal"),className:"p-2 hover:bg-slate-100 rounded-full transition-colors","aria-label":"뒤로 가기",children:"←"}),e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"대화 상세"})]}),e.jsx(j,{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-600 mb-4",children:"대화를 찾을 수 없습니다."}),e.jsx(D,{onClick:()=>a("/journal"),variant:"primary",children:"목록으로"})]})})]});const c=n.createdAt instanceof Date?n.createdAt:((d=(r=n.createdAt)==null?void 0:r.toDate)==null?void 0:d.call(r))||new Date;return e.jsxs("div",{className:"h-full flex flex-col p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("button",{onClick:()=>a("/journal"),className:"p-2 hover:bg-slate-100 rounded-full transition-colors","aria-label":"뒤로 가기",children:"←"}),e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"대화 상세"})]}),e.jsx(j,{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-b border-slate-200 pb-4",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 mb-2",children:n.title}),e.jsxs("p",{className:"text-sm text-slate-500",children:[c.toLocaleDateString("ko-KR")," · ",i.length,"개 메시지"]})]}),e.jsx("div",{className:"space-y-3",children:i.map(s=>e.jsxs("div",{className:`p-3 rounded-lg ${s.role==="user"?"bg-brand-primary/10 ml-auto max-w-[80%]":"bg-slate-100 max-w-[80%]"}`,children:[e.jsx("p",{className:"text-sm font-semibold text-slate-600 mb-1",children:s.role==="user"?"나":"AI"}),e.jsx("p",{className:"text-slate-700 whitespace-pre-wrap",children:s.content}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:s.timestamp.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})})]},s.id))})]})})]})};export{F as ConversationDetail};

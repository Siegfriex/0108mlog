import{j as e,m as r,A as P}from"./framer-motion-BvSqCppS.js";import{r as n,i as ye,d as je,N as we}from"./react-vendor-avSTGVV9.js";import{B as j,u as Ne,E as k,a as ve,G as X,g as ke,b as Se,c as Ae}from"./index-z0VGOugt.js";import{s as Ce,X as K,r as Me,n as Te,P as Ie,M as U,C as ze,g as L,k as Ee,t as $e,u as De,v as Re,w as Oe,m as Z,q as _e,h as Pe,S as ee,c as te,F as se,d as ae,e as ie,x as Le,A as Fe}from"./lucide-react-DyWIlm_Y.js";import{s as We,a as Be,b as Ge,c as He}from"./firestore-Dd5RvIfw.js";import{V as Ye}from"./VoicePlayer-D3_djfAp.js";import"./firebase-Br2-H2XF.js";const Qe=({intensity:t="medium"})=>{const c=t==="low"?20:t==="high"?60:40;return e.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden z-0",children:[Array.from({length:c}).map((d,s)=>{const h=Math.random()*3+1,o=Math.random()*100,b=Math.random()*100,l=Math.random()*2,x=Math.random()*3+2;return e.jsx(r.div,{className:"absolute rounded-full bg-white",style:{width:`${h}px`,height:`${h}px`,left:`${o}%`,top:`${b}%`},animate:{opacity:[.3,1,.3],scale:[1,1.2,1]},transition:{duration:x,repeat:1/0,delay:l,ease:"easeInOut"}},`star-${s}`)}),e.jsx(r.div,{className:"absolute rounded-full blur-xl",style:{width:"200px",height:"200px",background:"radial-gradient(circle, rgba(255,255,255,0.3), transparent)",top:"10%",right:"15%"},animate:{opacity:[.4,.6,.4],scale:[1,1.05,1]},transition:{duration:4,repeat:1/0,ease:"easeInOut"}}),e.jsx(r.div,{className:"absolute w-full h-full",style:{background:"linear-gradient(180deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.15) 50%, transparent 100%)",top:0,left:0},animate:{opacity:[.3,.5,.3]},transition:{duration:6,repeat:1/0,ease:"easeInOut"}})]})},Xe=()=>e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[e.jsxs(r.div,{className:"relative w-8 h-8",animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:[e.jsx(r.div,{className:"absolute inset-0 rounded-full border-2 border-brand-primary/30",animate:{scale:[1,1.2,1],opacity:[.5,.8,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),e.jsx(r.div,{className:"absolute top-1/2 left-1/2 w-2 h-2 -translate-x-1/2 -translate-y-1/2 bg-brand-primary rounded-full",animate:{scale:[1,1.5,1],opacity:[1,.7,1]},transition:{duration:1,repeat:1/0,ease:"easeInOut"}})]}),e.jsx("div",{className:"flex gap-1",children:[0,1,2].map(t=>e.jsx(r.div,{className:"w-2 h-2 bg-brand-primary rounded-full",animate:{y:[0,-8,0],opacity:[.5,1,.5],scale:[1,1.2,1]},transition:{duration:.8,repeat:1/0,delay:t*.2,ease:"easeInOut"}},t))}),e.jsx(r.span,{className:"text-xs text-slate-500 font-medium",animate:{opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},children:"생각 중..."})]}),Ke=(t,c)=>{const d=c===0||c===6,s=[];return t>=6&&t<9?s.push("아침","출근 전"):t>=9&&t<12?(s.push("오전","업무"),d||s.push("회의")):t>=12&&t<14?s.push("점심","식사"):t>=14&&t<18?s.push("오후","업무"):t>=18&&t<22?s.push("저녁","퇴근 후"):s.push("밤","휴식"),c===1&&s.push("월요일"),d&&s.push("주말"),s.slice(0,3)},Je=t=>{if(!t)return[];const c=[];return t.placeType==="work"?c.push("회사","업무","동료"):t.placeType==="home"?c.push("집","홈","가족"):c.push("외출","이동"),c.slice(0,3)},Ve=["출근","퇴근","회의","업무","점심","저녁","아침","밤","주말","휴식","운동","독서","가족","친구","혼자","스트레스","기쁨","평온","불안","슬픔","분노","피곤","에너지","집중"],qe=({onTagsChange:t,initialTags:c=[],locationPermission:d="default"})=>{const[s,h]=n.useState(c),[o,b]=n.useState([]),[l,x]=n.useState(null),[m,S]=n.useState(!1),[g,C]=n.useState("");n.useEffect(()=>{(async()=>{const u=new Date,w=u.getHours(),I=u.getDay(),f=Ke(w,I);b(f),d==="granted"&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(A=>{const $={latitude:A.coords.latitude,longitude:A.coords.longitude,placeType:w>=9&&w<18&&I>=1&&I<=5?"work":"other"};x($);const F=Je($);b(G=>[...G,...F].slice(0,3))},A=>{console.warn("위치 감지 실패:",A)},{enableHighAccuracy:!1,timeout:5e3,maximumAge:6e4})})()},[d]);const M=i=>{if(s.includes(i)){const u=s.filter(w=>w!==i);h(u),t(u)}else if(s.length<3){const u=[...s,i];h(u),t(u)}},p=()=>{if(g.trim()&&s.length<3&&!s.includes(g.trim())){const i=[...s,g.trim()];h(i),t(i),C(""),S(!1)}},y=i=>{const u=s.filter(w=>w!==i);h(u),t(u)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 text-sm mb-1",children:"상황 태그"}),e.jsx("p",{className:"text-xs text-slate-500",children:"오늘은 어떤 상황이었나요? (선택사항, 최대 3개)"})]}),s.length>0&&e.jsxs("span",{className:"text-xs font-bold text-brand-primary",children:[s.length,"/3"]})]}),s.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(i=>e.jsxs(r.div,{initial:{scale:0},animate:{scale:1},className:"flex items-center gap-2 px-3 py-1.5 bg-brand-primary text-white rounded-full text-sm font-medium",children:[e.jsx(Ce,{size:14}),e.jsx("span",{children:i}),e.jsx("button",{onClick:()=>y(i),className:"hover:bg-white/20 rounded-full p-0.5 transition-colors","aria-label":`${i} 태그 제거`,children:e.jsx(K,{size:14})})]},i))}),o.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Me,{size:14,className:"text-slate-400"}),e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"추천 태그"}),l&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-slate-300",children:"•"}),e.jsx(Te,{size:14,className:"text-slate-400"}),e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"위치 기반"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.filter(i=>!s.includes(i)).map(i=>e.jsx(r.button,{onClick:()=>M(i),whileHover:{scale:1.05},whileTap:{scale:.95},disabled:s.length>=3,className:`
                    px-3 py-1.5 rounded-full text-sm font-medium
                    transition-all duration-300
                    ${s.length>=3?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-white/80 border border-white/60 text-slate-700 hover:bg-brand-light hover:border-brand-primary/30"}
                  `,children:i},i))})]}),s.length<3&&e.jsx("div",{children:m?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:g,onChange:i=>C(i.target.value),onKeyPress:i=>i.key==="Enter"&&p(),placeholder:"태그 입력 (최대 10자)",maxLength:10,className:"flex-1 px-3 py-2 rounded-lg bg-white/80 border border-white/60 focus:outline-none focus:ring-2 focus:ring-brand-primary/50 text-sm"}),e.jsx(j,{onClick:p,variant:"primary",disabled:!g.trim(),className:"!px-4 !py-2",children:"추가"}),e.jsx(j,{onClick:()=>{S(!1),C("")},variant:"ghost",className:"!px-4 !py-2",children:"취소"})]}):e.jsxs("button",{onClick:()=>S(!0),className:"flex items-center gap-2 px-3 py-1.5 text-sm text-slate-500 hover:text-brand-primary transition-colors",children:[e.jsx(Ie,{size:14}),e.jsx("span",{children:"직접 입력하기"})]})}),s.length<3&&!m&&e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-slate-400 hover:text-slate-600 mb-2",children:"더 많은 태그 보기"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Ve.filter(i=>!s.includes(i)&&!o.includes(i)).slice(0,12).map(i=>e.jsx("button",{onClick:()=>M(i),disabled:s.length>=3,className:`
                    px-2 py-1 rounded-md text-xs
                    transition-all duration-300
                    ${s.length>=3?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-slate-50 text-slate-600 hover:bg-brand-light hover:text-brand-primary"}
                  `,children:i},i))})]})]})},Ue=({className:t="",text:c,onClick:d,onCheckIn:s,onWeeklySummary:h,onTodayAction:o,onSafety:b})=>{if(c&&d)return e.jsx(r.button,{onClick:d,whileHover:{scale:1.05},whileTap:{scale:.95},className:`
          flex items-center gap-2 px-4 py-2.5 rounded-full
          bg-white/80 backdrop-blur-sm border border-slate-200/60
          text-slate-700 hover:text-brand-primary hover:border-brand-primary/50
          font-medium text-xs
          whitespace-nowrap
          shadow-sm hover:shadow-md
          transition-all duration-300
          min-w-fit
          h-10
        `,children:e.jsx("span",{children:c})});const l=[{id:"checkin",label:"오늘 체크인",icon:e.jsx(U,{size:16,strokeWidth:2}),onClick:s,color:"bg-brand-primary"},{id:"summary",label:"이번 주 요약",icon:e.jsx(ze,{size:16,strokeWidth:2}),onClick:h,color:"bg-brand-secondary"},{id:"action",label:"오늘 1개",icon:e.jsx(L,{size:16,strokeWidth:2}),onClick:o,color:"bg-brand-accent"},{id:"safety",label:"안전 도움",icon:e.jsx(Ee,{size:16,strokeWidth:2}),onClick:b,color:"bg-red-500"}];return e.jsx("div",{className:`flex gap-2 overflow-x-auto scrollbar-hide pb-2 ${t}`,children:l.map(x=>e.jsxs(r.button,{onClick:x.onClick,whileHover:{scale:1.05},whileTap:{scale:.95},className:`
            flex items-center gap-2 px-4 py-2.5 rounded-full
            ${x.color} text-white
            font-bold text-xs
            whitespace-nowrap
            shadow-sm hover:shadow-md
            transition-all duration-300
            min-w-[100px]
            h-12
          `,children:[x.icon,e.jsx("span",{children:x.label})]},x.id))})},Ze=({actionTitle:t,onComplete:c,onSkip:d})=>{const[s,h]=n.useState("before"),[o,b]=n.useState(null),[l,x]=n.useState(null),m=y=>{b(y),h("after")},S=y=>{x(y),h("result")},g=()=>{h("after"),x(null)},C=()=>{o!==null&&l!==null&&c(o,l)},p=o===null||l===null?null:l-o;return e.jsx("div",{className:"w-full max-w-md mx-auto space-y-6",children:e.jsxs(P,{mode:"wait",children:[s==="before"&&e.jsxs(r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"bg-white/80 backdrop-blur-xl rounded-2xl p-6 border border-white/60 shadow-lg",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-2",children:"액션 시작 전"}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"지금 감정 강도는 어느 정도인가요?"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"강도"}),e.jsxs("span",{className:"text-xl font-bold text-brand-primary",children:[o!==null?o:"-","/10"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",value:o||5,onChange:y=>b(Number(y.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-brand-primary"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-400",children:[e.jsx("span",{children:"1"}),e.jsx("span",{children:"5"}),e.jsx("span",{children:"10"})]}),e.jsx(j,{onClick:()=>m(o||5),variant:"primary",className:"w-full",children:"다음 단계로"}),d&&e.jsx(j,{onClick:d,variant:"ghost",className:"w-full",children:"스킵"})]})]},"before"),s==="after"&&e.jsxs(r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"bg-white/80 backdrop-blur-xl rounded-2xl p-6 border border-white/60 shadow-lg",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-2",children:"액션 완료 후"}),e.jsxs("p",{className:"text-sm text-slate-600 mb-6",children:[t,"를 완료한 후 감정 강도는 어느 정도인가요?"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"강도"}),e.jsxs("span",{className:"text-xl font-bold text-brand-primary",children:[l!==null?l:"-","/10"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",value:l||o||5,onChange:y=>x(Number(y.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-brand-primary"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-400",children:[e.jsx("span",{children:"1"}),e.jsx("span",{children:"5"}),e.jsx("span",{children:"10"})]}),e.jsx(j,{onClick:()=>S(l||o||5),variant:"primary",className:"w-full",children:"결과 보기"}),e.jsxs(j,{onClick:g,variant:"ghost",className:"w-full",children:[e.jsx($e,{size:16,className:"mr-2"}),"5초 후 다시 체크"]})]})]},"after"),s==="result"&&p!==null&&e.jsxs(r.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.05},className:"bg-white/80 backdrop-blur-xl rounded-2xl p-6 border border-white/60 shadow-lg",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-2 text-center",children:"변화 결과"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 my-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-slate-700 mb-1",children:o}),e.jsx("div",{className:"text-xs text-slate-500",children:"Before"})]}),e.jsxs("div",{className:`
                flex items-center gap-2 px-4 py-2 rounded-full
                ${p>0?"bg-green-100 text-green-700":p<0?"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-700"}
              `,children:[p>0?e.jsx(De,{size:24}):p<0?e.jsx(Re,{size:24}):e.jsx(Oe,{size:24}),e.jsx("span",{className:"text-xl font-bold",children:p>0?`+${p}`:p})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-slate-700 mb-1",children:l}),e.jsx("div",{className:"text-xs text-slate-500",children:"After"})]})]}),e.jsx("div",{className:"text-center mb-6",children:p>0?e.jsxs("p",{className:"text-sm text-green-700 font-medium",children:["감정 강도가 ",p,"점 상승했어요"]}):p<0?e.jsxs("p",{className:"text-sm text-blue-700 font-medium",children:["감정 강도가 ",Math.abs(p),"점 하락했어요"]}):e.jsx("p",{className:"text-sm text-slate-600 font-medium",children:"감정 강도가 유지되었어요"})}),e.jsxs(j,{onClick:C,variant:"primary",className:"w-full",children:[e.jsx(Z,{size:18,className:"mr-2"}),"완료"]})]},"result")]})})},et=[{id:"MA-001",title:"2분 박스 호흡",description:"4초 들이마시기 → 4초 멈춤 → 4초 내쉬기 → 4초 멈춤. 4번 반복.",duration:"2 min",type:"breathing"},{id:"MA-002",title:"4-6 호흡(긴 내쉬기)",description:"4초 들이마시고 6초 내쉬기. 8번 반복.",duration:"2 min",type:"breathing"},{id:"MA-003",title:"긴 내쉬기 10번",description:'숨을 편하게 들이마신 뒤, 내쉬는 호흡을 "조금 더 길게" 10번.',duration:"2 min",type:"breathing"},{id:"MA-004",title:"5-4-3-2-1 감각 체크",description:"보이는 것 5개, 만져지는 것 4개, 들리는 것 3개, 냄새 2개, 맛 1개를 조용히 확인.",duration:"3 min",type:"breathing"},{id:"MA-005",title:"손을 가슴에(자기 체크)",description:'한 손을 가슴에 두고 "지금 이 순간"에 집중하며 호흡 10번.',duration:"2 min",type:"breathing"},{id:"MA-006",title:"1분 바디 스캔 + 1분 호흡",description:"머리→어깨→가슴→배→다리 순서로 긴장 부위를 찾고, 마지막 1분은 호흡만.",duration:"2 min",type:"breathing"},{id:"MA-007",title:"3문장 마음 정리",description:'"지금 느끼는 감정은 ___.", "몸은 ___.", "다음에 필요한 건 ___." 3문장만 작성.',duration:"3 min",type:"breathing"},{id:"MA-008",title:"어깨/목 풀기(3분)",description:"어깨를 10번 돌리고, 목을 좌/우 천천히 10초씩. 마지막에 깊게 기지개.",duration:"3 min",type:"exercise"},{id:"MA-009",title:"3분 걷기",description:"집/사무실에서라도 3분만 천천히 걷기. 걸으며 발바닥 감각에 집중.",duration:"3 min",type:"exercise"},{id:"MA-010",title:"전신 기지개 2분",description:"팔을 머리 위로 올려 10초 유지 → 옆구리 늘리기 좌/우 → 몸통 비틀기.",duration:"2 min",type:"exercise"},{id:"MA-011",title:"손목/등 스트레칭",description:"손목을 가볍게 풀고, 등(견갑)을 30초씩 늘리기.",duration:"2 min",type:"exercise"},{id:"MA-012",title:"제자리 걷기(4분)",description:"1분 제자리 걷기 + 30초 쉬기 × 2세트. 숨이 너무 차지 않게.",duration:"4 min",type:"exercise"},{id:"MA-013",title:"물 한 잔 + 자세 리셋",description:"물 한 잔 마시고, 의자에 앉아 골반/등/목을 곧게 30초 유지.",duration:"3 min",type:"exercise"},{id:"MA-014",title:"감정 이름 붙이기",description:'"나는 지금 ___을 느낀다" 한 줄 + 이유(한 줄)만.',duration:"2 min",type:"journaling"},{id:"MA-015",title:"오늘 잘한 것 1개",description:'오늘 내가 한 "작은 성공" 1가지만 적기.',duration:"2 min",type:"journaling"},{id:"MA-016",title:"감사 1줄",description:"감사한 것 1개를 1줄로 적기(사람/상황/나 자신).",duration:"2 min",type:"journaling"},{id:"MA-017",title:'다음 "가장 작은 한 걸음"',description:'지금 해야 할 일/목표가 있다면 "5분 안에 가능한 1단계"를 적고, 시작 버튼만 누르기(실행은 선택).',duration:"3 min",type:"journaling"},{id:"MA-018",title:"머릿속 비우기 3줄",description:'떠오르는 생각을 3줄로 적고, 마지막 줄에 "지금은 여기까지"라고 마무리.',duration:"3 min",type:"journaling"},{id:"MA-019",title:"걱정 타임박스",description:'걱정을 2분 동안 적고, 마지막 1분은 "다음에 할 수 있는 1개"만 적기.',duration:"3 min",type:"journaling"},{id:"MA-020",title:"오늘의 우선순위 1개",description:"오늘 가장 중요한 것 1개만 정하고, 나머지는 잠시 내려놓기.",duration:"2 min",type:"journaling"},{id:"MA-021",title:"하루 마무리 한 줄",description:'"오늘의 나에게 한 줄"을 쓰기.',duration:"2 min",type:"journaling"},{id:"MA-022",title:"고마움 메시지 1개",description:'고마운 사람에게 짧게 "고마웠어" 한 문장 보내기(길게 X).',duration:"2 min",type:"mindfulness"},{id:"MA-023",title:"나에게 응원 한 줄",description:'"나는 지금도 충분히 하고 있어"처럼 나에게 한 문장.',duration:"2 min",type:"mindfulness"},{id:"MA-024",title:"안부 한 줄(가벼운 연결)",description:"부담 없는 안부 1줄 보내기(답을 기대하지 않기).",duration:"3 min",type:"mindfulness"},{id:"MA-025",title:"미소/표정 풀기",description:"턱/미간 힘을 풀고, 어깨를 내리며 10초 미소.",duration:"2 min",type:"mindfulness"},{id:"MA-026",title:"책상 위 2분 정리",description:'눈에 보이는 3가지만 제자리로. 끝나면 "완료"만 누르기.',duration:"2 min",type:"mindfulness"},{id:"MA-027",title:"창문 열기 + 공기 바꾸기",description:"창문을 열고 10번 천천히 호흡. 창문이 없다면 자리에서 몸을 펴기.",duration:"2 min",type:"mindfulness"},{id:"MA-028",title:"빛/소리 세팅",description:"화면 밝기/조명 조정, 불필요한 알림 끄기(10분만).",duration:"3 min",type:"mindfulness"},{id:"MA-029",title:"내일을 위한 1분 준비",description:"내일의 첫 할 일 1개를 적고(1분), 필요한 것 1가지만 꺼내두기(2분).",duration:"3 min",type:"journaling"},{id:"MA-030",title:"좋아하는 음악 1곡",description:"좋아하는 음악 1곡을 들으며 호흡/몸 감각만 느끼기.",duration:"3 min",type:"mindfulness"}],E=t=>et.filter(c=>c.type===t),tt=t=>t>=8?E("breathing").slice(0,3):t>=5?[...E("breathing").slice(0,2),...E("exercise").slice(0,2)]:[...E("journaling").slice(0,2),...E("mindfulness").slice(0,2)],st=(t,c)=>{const d=tt(c);return t==="JOY"||t==="PEACE"?[...E("mindfulness").slice(0,2),...E("journaling").slice(0,2),...d.slice(0,1)]:t==="ANXIETY"||t==="SADNESS"?[...E("journaling").slice(0,2),...E("mindfulness").slice(0,2),...d.slice(0,1)]:d},at=[{id:k.JOY,label:"완전 최고",icon:e.jsx(ee,{size:36,strokeWidth:2}),color:"text-amber-500",bgGradient:"from-amber-200/40 via-yellow-100/40 to-orange-100/40"},{id:k.PEACE,label:"괜찮아요",icon:e.jsx(te,{size:36,strokeWidth:2}),color:"text-brand-primary",bgGradient:"from-brand-secondary/40 via-teal-100/40 to-cyan-100/40"},{id:k.ANXIETY,label:"조금 불안해요",icon:e.jsx(se,{size:36,strokeWidth:2}),color:"text-orange-500",bgGradient:"from-orange-200/40 via-red-100/40 to-amber-100/40"},{id:k.SADNESS,label:"우울해요",icon:e.jsx(ae,{size:36,strokeWidth:2}),color:"text-indigo-500",bgGradient:"from-indigo-200/40 via-purple-100/40 to-slate-100/40"},{id:k.ANGER,label:"화가 나요",icon:e.jsx(ie,{size:36,strokeWidth:2}),color:"text-rose-500",bgGradient:"from-rose-200/40 via-red-100/40 to-orange-100/40"}],it=[{id:"1",text:"오늘 하루는 어땠어요?",emotion:null},{id:"2",text:"무엇이 기분에 영향을 줬나요?",emotion:null},{id:"3",text:"지금 가장 필요한 건 뭐예요?",emotion:null}],nt=({persona:t,onSave:c,setImmersive:d,onNavigateToReports:s,onOpenSafety:h,onEmotionChange:o})=>{const{triggerHaptic:b}=Ne(),[l,x]=n.useState([]),[m,S]=n.useState(null),[g,C]=n.useState(5),[M,p]=n.useState(""),[y,i]=n.useState(!1),[u,w]=n.useState(null),[I,f]=n.useState(!1),[A,$]=n.useState(!1),[F,G]=n.useState(!1),[W,ne]=n.useState(!1),[D,le]=n.useState([]),[H,Y]=n.useState(!1),[re,oe]=n.useState(!0),[ce,de]=n.useState(!1),[xe,B]=n.useState(!0),J=n.useRef(null),O=n.useRef(null),V=n.useRef(null),me=()=>{var a;(a=J.current)==null||a.scrollIntoView({behavior:"smooth"})};n.useEffect(me,[l,y]);const pe=()=>{oe(!1),o==null||o(m),setTimeout(()=>{de(!0),G(!0);const a={id:"greeting",role:"assistant",content:`안녕하세요! ${t.name}입니다. ${z==null?void 0:z.label} 기분이시군요. 어떤 이야기를 나눠볼까요?`,timestamp:new Date};x([a])},500)};n.useEffect(()=>()=>{d(!1),O.current&&clearTimeout(O.current)},[d]);const z=at.find(a=>a.id===m),ue=a=>{S(a),b("medium")},he=a=>{var v;p(a),B(!1),(v=V.current)==null||v.focus(),b("light")},q=async()=>{if(!M.trim())return;b("light"),B(!1);const a={id:Date.now().toString(),role:"user",content:M,timestamp:new Date};x(N=>[...N,a]),p(""),i(!0);const v=l.map(N=>`${N.role==="user"?"사용자":t.name}: ${N.content}`),R=new Promise(N=>{O.current=setTimeout(()=>{N("분석에 시간이 걸리고 있어요. 잠시 후 다시 시도해주세요.")},8e3)});try{const N=ke(a.content,v,t),T=await Promise.race([N,R]),_={id:(Date.now()+1).toString(),role:"assistant",content:T,timestamp:new Date};x(ge=>[...ge,_])}catch(N){console.error("AI 응답 생성 오류:",N);const T={id:(Date.now()+1).toString(),role:"assistant",content:"연결에 문제가 발생했습니다. 잠시 후 다시 시도해주세요.",timestamp:new Date};x(_=>[..._,T])}finally{O.current&&(clearTimeout(O.current),O.current=null),i(!1)}},Q=async()=>{if(W||I)return;if(!H&&D.length===0){Y(!0);return}ne(!0),d(!1);const a=m||k.PEACE,v=l.length>1?l[1].content.slice(0,30):"체크인",R=l.map(T=>`[${T.role==="user"?"나":t.name}]: ${T.content}`).join(`

`),N={id:Date.now().toString(),date:new Date,type:"day",emotion:a,intensity:g,summary:v,detail:R,nuanceTags:D};try{const T=await Be({title:v,messages:l.map(_=>({role:_.role,content:_.content})),emotion:a,intensity:g,modeAtTime:"day",contextTags:D.length>0?D:void 0});await Ge({emotion:a,intensity:g,modeAtTime:"day",contextTags:D.length>0?D:void 0,conversationId:T})}catch(T){console.error("Error saving to Firestore:",T)}c(N)},fe=async()=>{if(!m)return;f(!0);const R=st(m,g)[0]||await Se(m,g,l.map(N=>N.content).join(" "));w(R),f(!1)},be=async(a,v)=>{if(u)try{await We({actionId:u.id,actionTitle:u.title,beforeIntensity:a,afterIntensity:v,completed:!0,skipped:!1})}catch(R){console.error("Error saving micro action log:",R)}$(!1),w(null)};return e.jsxs(e.Fragment,{children:[e.jsx(ve,{isOpen:re,selectedEmotion:m,intensity:g,onEmotionSelect:ue,onIntensityChange:a=>{C(a),b("light")},onComplete:pe}),e.jsx(P,{children:ce&&e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5,ease:[.16,1,.3,1]},className:"flex flex-col h-full w-full",children:[e.jsxs(r.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},className:"flex items-center justify-between p-4 sm:p-6 border-b border-slate-200/50 bg-white/30 backdrop-blur-md",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[z&&e.jsx(r.div,{className:`${z.color} p-2 rounded-xl bg-white/60 backdrop-blur-sm shadow-sm`,whileHover:{scale:1.05},whileTap:{scale:.95},children:z.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-lg text-slate-800",children:(z==null?void 0:z.label)||"감정 체크인"}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_e,{size:12,className:"text-rose-400 fill-rose-400"}),e.jsxs("span",{className:"text-xs text-slate-500",children:["강도: ",g,"/10"]})]}),e.jsx("span",{className:"text-xs text-slate-400",children:"•"}),e.jsx("span",{className:"text-xs text-slate-500",children:t.name})]})]})]}),e.jsx("button",{onClick:()=>d(!1),className:"p-2 rounded-full hover:bg-white/60 transition-colors text-slate-600","aria-label":"닫기",children:e.jsx(K,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 scrollbar-hide min-h-0",children:[l.map((a,v)=>e.jsx(r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:v*.05},className:`flex ${a.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs(r.div,{className:`
                      max-w-[85%] sm:max-w-[75%] rounded-2xl px-4 py-3 shadow-sm
                      ${a.role==="user"?"bg-gradient-to-br from-brand-primary to-brand-secondary text-white shadow-brand-primary/20":"bg-white/80 backdrop-blur-md text-slate-900 border border-white/60 shadow-slate-200/50"}
                    `,whileHover:{scale:1.02},transition:{type:"spring",stiffness:400,damping:17},children:[a.role==="assistant"&&e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-gradient-to-br from-brand-primary to-brand-secondary flex items-center justify-center",children:e.jsx(U,{size:12,className:"text-white"})}),e.jsx("span",{className:"text-xs font-semibold text-brand-primary",children:t.name})]}),e.jsx("p",{className:`text-sm leading-relaxed ${a.role==="user"?"text-white":"text-slate-800"}`,children:a.content})]})},a.id)),y&&e.jsx(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"flex justify-start",children:e.jsx("div",{className:"bg-white/80 backdrop-blur-md rounded-2xl shadow-sm border border-white/60 p-3",children:e.jsx(Xe,{})})}),e.jsx("div",{ref:J})]}),e.jsx(P,{children:xe&&l.length>0&&!y&&e.jsx(r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"px-4 sm:px-6 pb-2",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-2",children:it.map(a=>e.jsx(Ue,{text:a.text,onClick:()=>he(a.text)},a.id))})})}),e.jsxs(P,{children:[u&&!W&&!A&&e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"p-4 sm:p-6 border-t border-slate-200/50 bg-white/30 backdrop-blur-md",children:e.jsxs(X,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(L,{size:18,className:"text-brand-primary"}),e.jsx("h3",{className:"font-bold text-lg text-slate-800",children:"오늘의 작은 실천"})]}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:u.description})]}),e.jsx("button",{onClick:()=>w(null),className:"p-1 rounded-full hover:bg-slate-100 transition-colors text-slate-400","aria-label":"액션 카드 닫기",children:e.jsx(K,{size:18})})]}),e.jsxs(j,{variant:"primary",className:"w-full",onClick:()=>$(!0),children:["시도해보기 (",u.duration,")"]})]})}),A&&u&&e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"p-4 sm:p-6 border-t border-slate-200/50 bg-white/30 backdrop-blur-md",children:e.jsx(Ze,{actionTitle:u.title,onComplete:be,onSkip:()=>{$(!1),w(null)}})})]}),H&&e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-4 sm:p-6 border-t border-slate-200/50 bg-white/40 backdrop-blur-md",children:[e.jsx(qe,{onTagsChange:a=>le(a),initialTags:D,locationPermission:"granted"}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(j,{onClick:()=>{Y(!1),Q()},variant:"primary",className:"flex-1",children:"저장하기"}),e.jsx(j,{onClick:()=>{Y(!1),Q()},variant:"ghost",children:"스킵"})]})]}),!H&&e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-4 sm:p-6 border-t border-slate-200/50 bg-white/40 backdrop-blur-md",children:[e.jsx("div",{className:"flex gap-2 mb-3",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{ref:V,type:"text",value:M,onChange:a=>{p(a.target.value),B(!1)},onKeyPress:a=>a.key==="Enter"&&!a.shiftKey&&q(),onFocus:()=>B(!1),placeholder:"무엇이든 편하게 말씀해주세요...",className:"w-full px-4 py-3 pr-12 rounded-full bg-white/80 backdrop-blur-sm border border-slate-200/60 focus:outline-none focus:ring-2 focus:ring-brand-primary/50 focus:border-brand-primary/50 text-slate-800 placeholder-slate-400 transition-all","aria-label":"메시지 입력"}),e.jsx("button",{onClick:q,disabled:!M.trim(),className:"absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-full bg-brand-primary text-white hover:bg-brand-secondary disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm hover:shadow-md","aria-label":"전송",children:e.jsx(Pe,{size:16})})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{onClick:Q,variant:"secondary",className:"flex-1",disabled:W,"aria-label":"체크인 완료 및 저장",children:W?"저장 완료 ✓":"대화 마무리"}),e.jsx(j,{onClick:fe,variant:"ghost",isLoading:I,className:"px-4","aria-label":"마이크로 액션 생성",title:"오늘의 작은 실천 추천받기",children:e.jsx(L,{size:18,className:I?"animate-pulse":""})})]})]})]})})]})},lt=[{id:k.JOY,label:"기쁨",icon:e.jsx(ee,{size:40,strokeWidth:1.5}),color:"joy"},{id:k.PEACE,label:"평온",icon:e.jsx(te,{size:40,strokeWidth:1.5}),color:"peace"},{id:k.ANXIETY,label:"불안",icon:e.jsx(se,{size:40,strokeWidth:1.5}),color:"anxiety"},{id:k.SADNESS,label:"슬픔",icon:e.jsx(ae,{size:40,strokeWidth:1.5}),color:"sadness"},{id:k.ANGER,label:"분노",icon:e.jsx(ie,{size:40,strokeWidth:1.5}),color:"anger"}],rt=({persona:t,onSave:c,onEmotionChange:d})=>{const[s,h]=n.useState("emotion"),[o,b]=n.useState(null),[l,x]=n.useState(5),[m,S]=n.useState(""),[g,C]=n.useState(""),[M,p]=n.useState(!1),[y,i]=n.useState(!1),u=()=>{s==="emotion"&&o&&h("diary")},w=async()=>{if(!m.trim())return;p(!0);const f=await Ae(m,t);C(f),h("letter"),p(!1);const A=o||k.PEACE,$={id:Date.now().toString(),date:new Date,type:"night",emotion:A,intensity:l,summary:m.slice(0,40)+(m.length>40?"...":""),detail:`[감정]: ${A} (강도: ${l})
[나의 일기]
${m}

[${t.name}의 답장]
${f}`};try{await He({content:m,emotion:A,intensity:l,letterContent:f})}catch(F){console.error("일기 저장 오류:",F)}c($),i(!0),setTimeout(()=>i(!1),3e3)},I=()=>{h("emotion"),S(""),C(""),b(null),x(5)};return e.jsxs("div",{className:"w-full max-w-4xl mx-auto h-full flex flex-col px-4 text-white relative overflow-hidden",children:[e.jsx(Qe,{intensity:"medium"}),e.jsxs("div",{className:"py-6 shrink-0 text-center",children:[e.jsxs("h2",{className:"text-2xl font-serif font-bold flex items-center justify-center gap-2 mb-2 drop-shadow-md",children:[e.jsx("span",{className:"text-purple-300",children:e.jsx(Le,{size:20,fill:"currentColor"})}),s==="emotion"?"저녁 성찰":s==="diary"?"나의 이야기":"당신을 위한 편지"]}),e.jsx("p",{className:"text-white/60 text-sm font-medium",children:s==="emotion"?"오늘 하루 기분은 어떠셨나요?":s==="diary"?"모두 털어놓으세요. 밤이 듣고 있어요.":`${t.name}의 메시지`})]}),e.jsxs(P,{mode:"wait",children:[s==="emotion"&&e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex-1 flex flex-col justify-center items-center gap-8 max-w-2xl mx-auto w-full",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6 w-full",children:lt.map(f=>e.jsxs("button",{onClick:()=>{b(f.id),d==null||d(f.id)},className:`
                                aspect-square p-6 rounded-[32px] backdrop-blur-md border text-left transition-all duration-300 flex flex-col justify-center items-center gap-4 group
                                ${o===f.id?"bg-white/20 border-white/60 shadow-[0_0_40px_rgba(255,255,255,0.1)] scale-105 ring-1 ring-white/50":"bg-white/5 border-white/5 hover:bg-white/10"}
                            `,children:[e.jsx("span",{className:"text-white/80 group-hover:scale-110 transition-transform duration-300",children:f.icon}),e.jsx("span",{className:"text-white/90 font-medium text-lg tracking-wide",children:f.label})]},f.id))}),o&&e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/5 backdrop-blur-xl rounded-[32px] p-8 border border-white/10 w-full",children:[e.jsxs("div",{className:"flex justify-between text-white font-bold mb-6",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider text-purple-200",children:"감정 깊이"}),e.jsx("span",{className:"text-xl",children:l})]}),e.jsx("input",{type:"range",min:"1",max:"10",value:l,onChange:f=>x(Number(f.target.value)),className:"w-full h-2 bg-white/20 rounded-full appearance-none cursor-pointer accent-purple-300"}),e.jsxs(j,{onClick:u,className:"w-full mt-8 py-4 bg-purple-500 hover:bg-purple-600 border-none text-white font-bold text-lg shadow-xl shadow-purple-900/40",children:["계속하기 ",e.jsx(Fe,{size:20})]})]})]},"step-emotion"),s==="diary"&&e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex-1 flex flex-col gap-6 w-full max-w-3xl mx-auto pb-10",children:[e.jsx(X,{className:"flex-1 !bg-black/20 !border-white/10 !rounded-[40px] overflow-hidden min-h-[400px] shadow-2xl backdrop-blur-md",children:e.jsx("textarea",{value:m,onChange:f=>S(f.target.value),placeholder:"오늘 하루를 기록해보세요...",className:"w-full h-full bg-transparent resize-none focus:outline-none text-white placeholder:text-white/20 text-xl leading-relaxed p-4 font-serif",autoFocus:!0})}),e.jsxs(j,{onClick:w,isLoading:M,className:"w-full py-5 bg-gradient-to-r from-purple-600 to-indigo-600 shadow-lg border-none text-lg font-bold rounded-[24px]",children:[e.jsx(L,{className:"w-5 h-5 mr-2"}),"별에게 보내기"]})]},"step-diary"),s==="letter"&&e.jsx(r.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"flex-1 flex flex-col h-full overflow-hidden pb-10 w-full max-w-3xl mx-auto",children:e.jsxs(X,{className:"h-full flex flex-col !bg-indigo-950/60 !border-white/10 !rounded-[40px] !p-8 shadow-2xl backdrop-blur-xl",children:[e.jsxs("div",{className:"flex justify-between items-start mb-8 shrink-0 pb-6 border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-indigo-500/50 flex items-center justify-center shadow-lg border border-white/10",children:e.jsx(L,{size:24,className:"text-purple-200"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-bold text-lg",children:["보낸이. ",t.name]}),e.jsxs("span",{className:"text-indigo-300 text-xs font-medium uppercase tracking-wider",children:["인공지능 ",t.role]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Ye,{text:g})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-4 scrollbar-hide",children:e.jsx("div",{className:"prose prose-lg prose-invert prose-p:text-indigo-100 prose-p:leading-loose prose-p:font-light font-serif",children:e.jsx("p",{className:"whitespace-pre-wrap",children:g})})}),e.jsx("div",{className:"pt-6 mt-6 border-t border-white/5 shrink-0",children:e.jsx(j,{variant:"ghost",onClick:I,className:"w-full text-indigo-300 hover:text-white hover:bg-white/5 py-4 text-base",children:"새 기록 시작하기"})})]})},"step-letter")]}),e.jsx(P,{children:y&&e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"fixed top-24 left-1/2 -translate-x-1/2 z-50 flex items-center gap-3 px-6 py-3 bg-emerald-500/90 backdrop-blur-xl text-white rounded-full shadow-2xl border border-white/20",children:[e.jsx(Z,{size:20}),e.jsx("span",{className:"font-bold text-sm",children:"저장되었습니다"})]})})]})},ht=()=>{const t=ye(),c=je();if(!t)return e.jsx(we,{to:"/",replace:!0});const{mode:d,persona:s,setIsImmersive:h,timelineData:o,setPersona:b}=t,l=S=>{},x=()=>{c("/reports/weekly")},m=()=>{c("/safety")};return d==="day"?e.jsx(nt,{persona:s,onSave:l,setImmersive:h,onNavigateToReports:x,onOpenSafety:m}):e.jsx(rt,{persona:s,onSave:l})};export{ht as ChatMain};
